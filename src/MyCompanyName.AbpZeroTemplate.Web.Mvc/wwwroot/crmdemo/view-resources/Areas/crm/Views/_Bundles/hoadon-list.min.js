var DichVuController=function(a){function n(){s.ajax.reload()}function i(a){abp.message.confirm("",function(i){i&&u.delete({id:a.id}).done(function(){n(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var e=a.getModal().find("#HangHoaDichVuTab"),t=a.getModal().find("input[name=tongTienHang]"),o=a.getModal().find("input[name=id]").val(),l=a.getModal().find("input[name=tempId]").val(),r=!1,d=null;if(""!=o&&void 0!=o||(o=l,r=!0),""!=o){var h=$("#HoaDonBanLeChiTietsTable"),u=abp.services.app.hoaDonBanLeChiTiets;$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var c={create:abp.auth.hasPermission("Pages.HoaDonBanLeChiTiets.Create"),edit:abp.auth.hasPermission("Pages.HoaDonBanLeChiTiets.Edit"),delete:abp.auth.hasPermission("Pages.HoaDonBanLeChiTiets.Delete")},T=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLeChiTiets/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLeChiTiets/_CreateOrEditModal.js",modalClass:"CreateOrEditHoaDonBanLeChiTietModal"}),p=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLeChiTiets/ViewhoaDonBanLeChiTietModal",modalClass:"ViewHoaDonBanLeChiTietModal"}),s=h.DataTable({paging:!0,serverSide:!0,processing:!0,fnDrawCallback:function(a){var n=a.rawServerResponse.additionalData;t.val(n.tongTienHang)},listAction:{ajaxFunction:u.getAll,inputFilter:function(){return{filter:e.find("#HoaDonBanLeChiTietsTableFilter").val(),hoaDonId:o,hoaDonTempId:l,minSoThuTuFilter:e.find("#MinSoThuTuFilterId").val(),maxSoThuTuFilter:e.find("#MaxSoThuTuFilterId").val(),minThoiGianFilter:e.find("#MinThoiGianFilterId").val(),maxThoiGianFilter:e.find("#MaxThoiGianFilterId").val(),minThoiGianBaoHanhFilter:e.find("#MinThoiGianBaoHanhFilterId").val(),maxThoiGianBaoHanhFilter:e.find("#MaxThoiGianBaoHanhFilterId").val(),minLoaiThoiGianBHFilter:e.find("#MinLoaiThoiGianBHFilterId").val(),maxLoaiThoiGianBHFilter:e.find("#MaxLoaiThoiGianBHFilterId").val(),iD_MaVachFilter:e.find("#ID_MaVachFilterId").val(),chatLieuFilter:e.find("#ChatLieuFilterId").val(),mauSacFilter:e.find("#MauSacFilterId").val(),kichCoFilter:e.find("#KichCoFilterId").val(),minSoLuongFilter:e.find("#MinSoLuongFilterId").val(),maxSoLuongFilter:e.find("#MaxSoLuongFilterId").val(),minDonGiaFilter:e.find("#MinDonGiaFilterId").val(),maxDonGiaFilter:e.find("#MaxDonGiaFilterId").val(),minThanhTienFilter:e.find("#MinThanhTienFilterId").val(),maxThanhTienFilter:e.find("#MaxThanhTienFilterId").val(),minPTChietKhauFilter:e.find("#MinPTChietKhauFilterId").val(),maxPTChietKhauFilter:e.find("#MaxPTChietKhauFilterId").val(),minTienChietKhauFilter:e.find("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:e.find("#MaxTienChietKhauFilterId").val(),minTienThueFilter:e.find("#MinTienThueFilterId").val(),maxTienThueFilter:e.find("#MaxTienThueFilterId").val(),minPTChiPhiFilter:e.find("#MinPTChiPhiFilterId").val(),maxPTChiPhiFilter:e.find("#MaxPTChiPhiFilterId").val(),minTienChiPhiFilter:e.find("#MinTienChiPhiFilterId").val(),maxTienChiPhiFilter:e.find("#MaxTienChiPhiFilterId").val(),minThanhToanFilter:e.find("#MinThanhToanFilterId").val(),maxThanhToanFilter:e.find("#MaxThanhToanFilterId").val(),minGiaVonFilter:e.find("#MinGiaVonFilterId").val(),maxGiaVonFilter:e.find("#MaxGiaVonFilterId").val(),ghiChuFilter:e.find("#GhiChuFilterId").val(),userNhapFilter:e.find("#UserNhapFilterId").val(),minSoLanDaInFilter:e.find("#MinSoLanDaInFilterId").val(),maxSoLanDaInFilter:e.find("#MaxSoLanDaInFilterId").val(),iD_TangKemFilter:e.find("#ID_TangKemFilterId").val(),tangKemFilter:e.find("#TangKemFilterId").val(),minThoiGianThucHienFilter:e.find("#MinThoiGianThucHienFilterId").val(),maxThoiGianThucHienFilter:e.find("#MaxThoiGianThucHienFilterId").val(),minSoLuong_TLFilter:e.find("#MinSoLuong_TLFilterId").val(),maxSoLuong_TLFilter:e.find("#MaxSoLuong_TLFilterId").val(),minSoLuong_YCFilter:e.find("#MinSoLuong_YCFilterId").val(),maxSoLuong_YCFilter:e.find("#MaxSoLuong_YCFilterId").val(),chieuFilter:e.find("#ChieuFilterId").val(),sangFilter:e.find("#SangFilterId").val(),minPTThueFilter:e.find("#MinPTThueFilterId").val(),maxPTThueFilter:e.find("#MaxPTThueFilterId").val(),maNhanVienThucHienFilter:e.find("#MaNhanVienThucHienFilterId").val(),tenNhanVienThucHienFilter:e.find("#TenNhanVienThucHienFilterId").val(),maNhanVienTuVanFilter:e.find("#MaNhanVienTuVanFilterId").val(),tenNhanVienTuVanFilter:e.find("#TenNhanVienTuVanFilterId").val(),maTheLanFilter:e.find("#MaTheLanFilterId").val(),maTheGiaTriFilter:e.find("#MaTheGiaTriFilterId").val(),hoaDonBanLeMaHoaDonFilter:e.find("#HoaDonBanLeMaHoaDonFilterId").val(),dM_HangHoaTenHangHoaFilter:e.find("#DM_HangHoaTenHangHoaFilterId").val(),dM_KhoTenKhoFilter:e.find("#DM_KhoTenKhoFilterId").val(),dM_DonViTinhTenDonViTinhFilter:e.find("#DM_DonViTinhTenDonViTinhFilterId").val(),dM_LoHangSoLoFilter:e.find("#DM_LoHangSoLoFilterId").val(),dM_ThueSuatMaThueSuatFilter:e.find("#DM_ThueSuatMaThueSuatFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("View"),action:function(a){p.open({data:a.record})}},{text:app.localize("Edit"),visible:function(){return c.edit},action:function(n){d=a.getModal().find("input[name=iD_DoiTuong]").val(),T.open({id:n.record.hoaDonBanLeChiTiet.id,khachHangId:d,hoaDonId:o})}},{text:app.localize("Delete"),visible:function(){return c.delete},action:function(a){i(a.record.hoaDonBanLeChiTiet)}}]}},{targets:1,data:"dM_HangHoaTenHangHoa"},{targets:2,data:"dM_DonViTinhTenDonViTinh"},{targets:3,data:"hoaDonBanLeChiTiet.thoiGian",render:function(a){return a?moment(a).format("L"):""}},{targets:4,data:"hoaDonBanLeChiTiet.thoiGianThucHien"},{targets:5,data:"hoaDonBanLeChiTiet.soLuong"},{targets:6,data:"hoaDonBanLeChiTiet.donGia"},{targets:7,data:"hoaDonBanLeChiTiet.thanhTien",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:8,data:"hoaDonBanLeChiTiet.ptChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:9,data:"hoaDonBanLeChiTiet.tienChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:10,data:"hoaDonBanLeChiTiet.thanhToan",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:11,data:"hoaDonBanLeChiTiet.ghiChu"},{targets:12,data:"hoaDonBanLeChiTiet.tangKem",render:function(a){return a?'<i class="la la-check-square m--font-success" title="True"></i>':'<i class="la la-times-circle" title="False"></i>'}},{targets:13,data:"hoaDonBanLeChiTiet.soLuong_TL"},{targets:14,data:"hoaDonBanLeChiTiet.maTheLan"},{targets:15,data:"hoaDonBanLeChiTiet.maTheGiaTri"}]});return e.find("#ShowAdvancedFiltersSpan").click(function(){e.find("#ShowAdvancedFiltersSpan").hide(),e.find("#HideAdvancedFiltersSpan").show(),e.find("#AdvacedAuditFiltersArea").slideDown()}),e.find("#HideAdvancedFiltersSpan").click(function(){e.find("#HideAdvancedFiltersSpan").hide(),e.find("#ShowAdvancedFiltersSpan").show(),e.find("#AdvacedAuditFiltersArea").slideUp()}),e.find("#CreateNewHoaDonBanLeChiTietButton").click(function(){""!=(d=a.getModal().find("input[name=iD_DoiTuong]").val())&&void 0!=d?T.open({id:null,hoaDonId:o,isTempData:r,khachHangId:d}):abp.notify.info(app.localize("YouNeedSelectCustomerFirst"))}),e.find("#ExportToExcelButton").click(function(){u.getHoaDonBanLeChiTietsToExcel({filter:e.find("#HoaDonBanLeChiTietsTableFilter").val(),minSoThuTuFilter:e.find("#MinSoThuTuFilterId").val(),maxSoThuTuFilter:e.find("#MaxSoThuTuFilterId").val(),minThoiGianFilter:e.find("#MinThoiGianFilterId").val(),maxThoiGianFilter:e.find("#MaxThoiGianFilterId").val(),minThoiGianBaoHanhFilter:e.find("#MinThoiGianBaoHanhFilterId").val(),maxThoiGianBaoHanhFilter:e.find("#MaxThoiGianBaoHanhFilterId").val(),minLoaiThoiGianBHFilter:e.find("#MinLoaiThoiGianBHFilterId").val(),maxLoaiThoiGianBHFilter:e.find("#MaxLoaiThoiGianBHFilterId").val(),iD_MaVachFilter:e.find("#ID_MaVachFilterId").val(),chatLieuFilter:e.find("#ChatLieuFilterId").val(),mauSacFilter:e.find("#MauSacFilterId").val(),kichCoFilter:e.find("#KichCoFilterId").val(),minSoLuongFilter:e.find("#MinSoLuongFilterId").val(),maxSoLuongFilter:e.find("#MaxSoLuongFilterId").val(),minDonGiaFilter:e.find("#MinDonGiaFilterId").val(),maxDonGiaFilter:e.find("#MaxDonGiaFilterId").val(),minThanhTienFilter:e.find("#MinThanhTienFilterId").val(),maxThanhTienFilter:e.find("#MaxThanhTienFilterId").val(),minPTChietKhauFilter:e.find("#MinPTChietKhauFilterId").val(),maxPTChietKhauFilter:e.find("#MaxPTChietKhauFilterId").val(),minTienChietKhauFilter:e.find("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:e.find("#MaxTienChietKhauFilterId").val(),minTienThueFilter:e.find("#MinTienThueFilterId").val(),maxTienThueFilter:e.find("#MaxTienThueFilterId").val(),minPTChiPhiFilter:e.find("#MinPTChiPhiFilterId").val(),maxPTChiPhiFilter:e.find("#MaxPTChiPhiFilterId").val(),minTienChiPhiFilter:e.find("#MinTienChiPhiFilterId").val(),maxTienChiPhiFilter:e.find("#MaxTienChiPhiFilterId").val(),minThanhToanFilter:e.find("#MinThanhToanFilterId").val(),maxThanhToanFilter:e.find("#MaxThanhToanFilterId").val(),minGiaVonFilter:e.find("#MinGiaVonFilterId").val(),maxGiaVonFilter:e.find("#MaxGiaVonFilterId").val(),ghiChuFilter:e.find("#GhiChuFilterId").val(),userNhapFilter:e.find("#UserNhapFilterId").val(),minSoLanDaInFilter:e.find("#MinSoLanDaInFilterId").val(),maxSoLanDaInFilter:e.find("#MaxSoLanDaInFilterId").val(),iD_TangKemFilter:e.find("#ID_TangKemFilterId").val(),tangKemFilter:e.find("#TangKemFilterId").val(),minThoiGianThucHienFilter:e.find("#MinThoiGianThucHienFilterId").val(),maxThoiGianThucHienFilter:e.find("#MaxThoiGianThucHienFilterId").val(),minSoLuong_TLFilter:e.find("#MinSoLuong_TLFilterId").val(),maxSoLuong_TLFilter:e.find("#MaxSoLuong_TLFilterId").val(),minSoLuong_YCFilter:e.find("#MinSoLuong_YCFilterId").val(),maxSoLuong_YCFilter:e.find("#MaxSoLuong_YCFilterId").val(),chieuFilter:e.find("#ChieuFilterId").val(),sangFilter:e.find("#SangFilterId").val(),minPTThueFilter:e.find("#MinPTThueFilterId").val(),maxPTThueFilter:e.find("#MaxPTThueFilterId").val(),maNhanVienThucHienFilter:e.find("#MaNhanVienThucHienFilterId").val(),tenNhanVienThucHienFilter:e.find("#TenNhanVienThucHienFilterId").val(),maNhanVienTuVanFilter:e.find("#MaNhanVienTuVanFilterId").val(),tenNhanVienTuVanFilter:e.find("#TenNhanVienTuVanFilterId").val(),maTheLanFilter:e.find("#MaTheLanFilterId").val(),maTheGiaTriFilter:e.find("#MaTheGiaTriFilterId").val(),hoaDonBanLeMaHoaDonFilter:e.find("#HoaDonBanLeMaHoaDonFilterId").val(),dM_HangHoaTenHangHoaFilter:e.find("#DM_HangHoaTenHangHoaFilterId").val(),dM_KhoTenKhoFilter:e.find("#DM_KhoTenKhoFilterId").val(),dM_DonViTinhTenDonViTinhFilter:e.find("#DM_DonViTinhTenDonViTinhFilterId").val(),dM_LoHangSoLoFilter:e.find("#DM_LoHangSoLoFilterId").val(),dM_ThueSuatMaThueSuatFilter:e.find("#DM_ThueSuatMaThueSuatFilterId").val()}).done(function(a){app.downloadTempFile(a)})}),abp.event.on("app.createOrEditHoaDonBanLeChiTietModalSaved",function(){n()}),e.find("#GetHoaDonBanLeChiTietsButton").click(function(a){a.preventDefault(),n()}),e.find(document).keypress(function(a){13===a.which&&n()}),!0}},NhanVienThucHien=function(a){function n(){c.ajax.reload()}function i(a){abp.message.confirm("",function(i){i&&r.delete({id:a.id}).done(function(){n(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}function e(a){o.find("input[name=id]").val(a.nhanVienThucHien.id),o.find("input[name=userName]").val(a.userName),o.find("input[name=nhanVien]").val(a.nhanVienThucHien.nhanVien),o.find("input[name=tienChietKhau]").val(a.nhanVienThucHien.tienChietKhau),o.find("input[name=pTDoanhThuDuocHuong]").val(a.nhanVienThucHien.ptDoanhThuDuocHuong),o.find("input[name=dienGiai]").val(a.nhanVienThucHien.dienGiai),o.find("input[name=laNhanVienChinh]").prop("checked",a.nhanVienThucHien.laNhanVienChinh)}var t=a.getModal(),o=t.find("form[name=AddNhanVienThucHienForm]"),l=(a.getModal().find("form[name=HoaDonBanLeInformationsForm]"),t.find("form[name=TheKhachHangInformationsForm]"),$("#NhanVienThucHiensTable")),r=abp.services.app.nhanVienThucHiens,d=t.find("input[name=id]").val();d=""==d||void 0==d?t.find("input[name=tempId]").val():d,$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var h={create:!0,edit:!0,delete:!0},u=new app.ModalManager({viewUrl:abp.appPath+"crm/Common/KTVLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Common/_KTVLookupTableModal.js",modalClass:"KTVLookupTableModal"}),c=l.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:r.getAll,inputFilter:function(){return{maChungTu:d,filter:$("#ChietKhauNhanViensTableFilter").val(),userNameFilter:$("#UserNameFilterId").val(),minTienChietKhauFilter:$("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:$("#MaxTienChietKhauFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("Edit"),visible:function(){return h.edit},action:function(a){_createOrEditModal.open({id:a.record.nhanVienThucHien.id})}},{text:app.localize("Delete"),visible:function(){return h.delete},action:function(a){i(a.record.nhanVienThucHien)}}]}},{targets:1,data:"userName"},{targets:2,data:"nhanVienThucHien.tienChietKhau"},{targets:3,data:"nhanVienThucHien.ptDoanhThuDuocHuong"},{targets:4,data:"nhanVienThucHien.dienGiai"}],select:{style:"single"}});c.on("select",function(a,n,i,t){c.rows({selected:!0}).count()>0&&e(c.rows({selected:!0}).data()[0])}),$(".OpenNhanVienThucHienLookupTableButton").click(function(){var a=$(this).parents("tr");u.open({id:a.find("input[name=nhanVien]").val(),displayName:a.find("input[name=userName]").val()},function(n){a.find("input[name=tenNhanVienThucHien]").val(n.tenNhanVien),a.find("input[name=ngayThucHien]").data("DateTimePicker").date(new Date),a.find("input[name=nhanVien]").val(n.id)})}),$(".ClearNhanVienThucHienButton").click(function(){var a=$(this).parents("tr");a.find("input[name=tenNhanVienThucHien]").val(""),a.find("input[name=nhanVien]").val("")}),$("#OpenNhanVienThucHienLookupTableButton").click(function(){var a=o.serializeFormToObject();u.open({id:a.id,displayName:a.userName},function(a){o.find("input[name=tenNhanVienThucHien]").val(a.tenNhanVien),o.find("input[name=nhanVien]").val(a.id)})}),$("#ClearNhanVienThucHienButton").click(function(){o.find("input[name=tenNhanVienThucHien]").val(""),o.find("input[name=nhanVien]").val("")});var T=function(){if(o.valid()){var a=o.serializeFormToObject();$("#NhanVienThucHienTable td .m-checkable").each(function(){if($(this).prop("checked")){var n=$(this).parents("tr");n.find("input[name=tenNhanVienThucHien]").val(a.tenNhanVienThucHien),n.find("input[name=ngayThucHien]").data("DateTimePicker").date(a.ngayThucHien),n.find("input[name=nhanVien]").val(a.nhanVien),n.find("select[name=danhGia]").val(a.danhGia),n.find("select[name=danhGia]").trigger("change")}})}};return $(".save-nhanvienthuchien-button").click(function(){T(),$(".create-nhanvienthuchien-button").show(),$("form[name=AddNhanVienThucHienForm]").hide()}),$(".create-nhanvienthuchien-button").click(function(){$("form[name=AddNhanVienThucHienForm]").show(),$(this).hide()}),t.find("#CreateNewChietKhauNhanVienButton").click(function(){o[0].reset()}),t.find("#GetChietKhauNhanViensButton").click(function(a){a.preventDefault(),n()}),$(document).keypress(function(a){13===a.which&&n()}),!0};!function(a){app.modals.CreateOrEditHoaDonBanLeModal=function(){function n(){var n=moment(a("#HoaDonBanLe_GioVao").data("DateTimePicker").date()),i=parseInt(""==a("input[name=thoiGianThucHien]").val()?"0":a("input[name=thoiGianThucHien]").val());n.add(i,"minutes"),a("#HoaDonBanLe_GioRa").data("DateTimePicker").date(n)}function i(){var n=a("input[name=tangKem]").prop("checked"),i=a("input[name=laTangKem]").val(),e=parseFloat(l.find("input[name=donGia]").val()),t=parseFloat(l.find("input[name=soLuong]").val()),o=parseFloat(T.find("input[name=soLuongHangTangConLai]").val()),r=parseFloat(T.find("input[name=soLuongHangChinhConLai]").val()),d=(parseFloat(""==a("input[name=soDu]").val()?"0":a("input[name=soDu]").val()),t-=parseFloat(""==a("input[name=soLanDaSuDungCuaHoaDonHienTai").val()?"0":a("input[name=soLanDaSuDungCuaHoaDonHienTai").val()));if("True"==i)return t>r?(abp.notify.info(app.localize("KhongTheSuDungQuaSoLuong")),!1):(l.find("input[name=thanhTien]").val(0),0);if(n){if(t>o){h=e*(d=t-o);return l.find("input[name=thanhTien]").val(h),d>t?(abp.notify.info(app.localize("KhongTheSuDungQuaSoLuong")),!1):h}return l.find("input[name=thanhTien]").val(0),0}if(d>r)return abp.notify.info(app.localize("KhongTheSuDungQuaSoLuong")),!1;var h=e*d;return l.find("input[name=thanhTien]").val(h),h}function e(n){if("undefined"==(n=n))return!1;var i=n*(100-parseFloat(l.find("input[name=pTChietKhau]").val()))/100,e=parseFloat(""==a("input[name=soDu]").val()?"0":a("input[name=soDu]").val());return!l.serializeFormToObject().isCreatedOnDay&&e<i?(abp.notify.info(app.localize("TaiKhoanKhongDuDeSuDungDichVu")),!1):i}abp.services.app.hoaDonBanLes;var t,o=abp.services.app.suDungThe,l=null,r=null,d=null,h=null,u=null,c=[],T=null,p=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/DM_ViTriLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_DM_ViTriLookupTableModal.js",modalClass:"DM_ViTriLookupTableModal"}),s=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/DM_DoiTuongLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_DM_DoiTuongLookupTableModal.js",modalClass:"DM_DoiTuongLookupTableModal"}),m=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/DM_TienTeLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_DM_TienTeLookupTableModal.js",modalClass:"DM_TienTeLookupTableModal"}),f=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/OrganizationUnitLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_OrganizationUnitLookupTableModal.js",modalClass:"OrganizationUnitLookupTableModal"}),v=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/UserLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_UserLookupTableModal.js",modalClass:"UserLookupTableModal"}),D=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/DM_DacDiemKhachHangLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_DM_DacDiemKhachHangLookupTableModal.js",modalClass:"DM_DacDiemKhachHangLookupTableModal"}),F=(new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/DM_LoaiChungTuLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_DM_LoaiChungTuLookupTableModal.js",modalClass:"DM_LoaiChungTuLookupTableModal"}),new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/TheGiaTriLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_TheGiaTriLookupTableModal.js",modalClass:"TheGiaTriLookupTableModal"})),g=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLeChiTiets/DM_HangHoaLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLeChiTiets/_DM_HangHoaLookupTableModal.js",modalClass:"DM_HangHoaLookupTableModal"});this.init=function(i){var e=(t=i).getModal();e.find(".numeric").number(!0,0),e.find(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var o=new Date;e.find(".datetime-picker").datetimepicker({locale:abp.localization.currentLanguage.name,defaultDate:o}),""!=e.find("#HoaDonBanLe_GioRa").val()&&e.find("#HoaDonBanLe_GioRa").val()!=e.find("#HoaDonBanLe_GioVao").val()||(parseInt(e.find("#HoaDonBanLeChiTiet_ThoiGianThucHien").val())>0?n():e.find("#HoaDonBanLe_GioRa").val("")),e.find(".date-picker").each(function(){"01/01/0001"==a(this).val()&&a(this).data("DateTimePicker").date(new Date)}),T=t.getModal().find("form[name=HoaDonBanLeInformationsForm]"),l=t.getModal().find("form[name=HoaDonBanLeChiTietInformationsForm]"),u=t.getModal().find("form[name=NhanVienThucHienForm]"),r=t.getModal().find("form[name=PhieuKhaoSatForm]"),T.validate(),l.validate(),d=null==d?DichVuController(t):d,h=null==h?NhanVienThucHien(t):h;$form=e.find("#fileupload").fileupload({dataType:"json"});var c=e.find("input[name=id]").val();void 0!==c&&c&&a.ajax({type:"GET",contentType:"application/json; charset=utf-8",url:"/crm/HoaDonBanLes/GetFileList/"+c,success:function(n){return a("#fileupload").fileupload("option","done").call(a("#fileupload"),a.Event("done"),{result:{files:n.files}}),a("#fileupload").removeClass("fileupload-processing"),!0},error:function(n,i,e){a("#fileupload").addClass("fileupload-processing")}})},a("#OpenDM_HangHoaLookupTableButton").click(function(){var a=l.serializeFormToObject();g.open({id:a.iD_HangHoa,displayName:a.dM_HangHoaTenHangHoa},function(a){l.find("input[name=dM_HangHoaTenHangHoa]").val(a.code+" - "+a.displayName),l.find("input[name=iD_HangHoa]").val(a.id),l.find("input[name=donGia]").val(a.donGia),l.find("input[name=thoiGianThucHien]").val(a.thoiGianThucHien),u.find("input[name=tienChietKhau]").val(a.thoiGianThucHien),n()})}),a("#ClearDM_HangHoaTenHangHoaButton").click(function(){l.find("input[name=dM_HangHoaTenHangHoa]").val(""),l.find("input[name=iD_HangHoa]").val(""),l.find("input[name=donGia]").val(""),l.find("input[name=thoiGianThucHien]").val(""),u.find("input[name=tienChietKhau]").val(""),n()}),a("#OpenDM_ViTriLookupTableButton").click(function(){var a=T.serializeFormToObject();p.open({id:a.iD_ViTri,displayName:a.dM_ViTriTenViTri},function(a){T.find("input[name=dM_ViTriTenViTri]").val(a.displayName),T.find("input[name=iD_ViTri]").val(a.id)})}),a("#ClearDM_ViTriTenViTriButton").click(function(){T.find("input[name=dM_ViTriTenViTri]").val(""),T.find("input[name=iD_ViTri]").val("")}),a("#OpenDM_DoiTuongLookupTableButton").click(function(){var a=T.serializeFormToObject();s.open({id:a.iD_DoiTuong,displayName:a.dM_DoiTuongTenDoiTuong},function(a){T.find("input[name=dM_DoiTuongTenDoiTuong]").val(a.code+" - "+a.displayName),T.find("input[name=iD_DoiTuong]").val(a.id),T.find("input[name=diaChi_KhachHang]").val(a.address),T.find("input[name=dienThoai_KhachHang]").val(a.phone),T.find("input[name=nhomDoiTuong]").val(a.group),T.find("input[name=soLanIn]").val(a.exchangeNumber),T.find("input[name=ngaySinh_KhachHang]").val(moment(a.dateOfBirth).format("L"))})}),a("#ClearDM_DoiTuongTenDoiTuongButton").click(function(){T.find("input[name=dM_DoiTuongTenDoiTuong]").val(""),T.find("input[name=iD_DoiTuong]").val("")}),a("#OpenDM_TienTeLookupTableButton").click(function(){var a=T.serializeFormToObject();m.open({id:a.iD_NgoaiTe,displayName:a.dM_TienTeTenNgoaiTe},function(a){T.find("input[name=dM_TienTeTenNgoaiTe]").val(a.displayName),T.find("input[name=iD_NgoaiTe]").val(a.id)})}),a("#ClearDM_TienTeTenNgoaiTeButton").click(function(){T.find("input[name=dM_TienTeTenNgoaiTe]").val(""),T.find("input[name=iD_NgoaiTe]").val("")}),a("#OpenUserLookupTableButton").click(function(){var a=T.serializeFormToObject();v.open({id:a.iD_NhanVien,displayName:a.userName},function(a){T.find("input[name=userName]").val(a.displayName),T.find("input[name=iD_NhanVien]").val(a.id)})}),a("#ClearUserNameButton").click(function(){T.find("input[name=userName]").val(""),T.find("input[name=iD_NhanVien]").val("")}),a("#OpenDM_DacDiemKhachHangLookupTableButton").click(function(){var a=T.serializeFormToObject();D.open({id:a.iD_DacDiemKhachHang,displayName:a.dM_DacDiemKhachHangTenDacDiem},function(a){T.find("input[name=dM_DacDiemKhachHangTenDacDiem]").val(a.displayName),T.find("input[name=iD_DacDiemKhachHang]").val(a.id)})}),a("#ClearDM_DacDiemKhachHangTenDacDiemButton").click(function(){T.find("input[name=dM_DacDiemKhachHangTenDacDiem]").val(""),T.find("input[name=iD_DacDiemKhachHang]").val("")}),a("#OpenDonViThucHienLookupTableButton").click(function(){var a=T.serializeFormToObject();f.open({id:a.iD_DonViThucHien,displayName:a.donViThucHienTenDonVi},function(a){T.find("input[name=donViThucHienTenDonVi]").val(a.displayName),T.find("input[name=iD_DonViThucHien]").val(a.id)})}),a("#ClearDonViThucHienTenDonViButton").click(function(){T.find("input[name=donViThucHienTenDonVi]").val(""),T.find("input[name=iD_DonViThucHien]").val("")}),a("#OpenTheGiaTriLookupTableButton").click(function(){var a=T.serializeFormToObject();F.open({displayName:a.maTheGiaTri,khachHangId:a.iD_DoiTuong},function(a){T.find("input[name=maTheGiaTri]").val(a.displayName).attr("max-value",a.soDu),T.find("input[name=truTuThe]").removeAttr("readonly"),T.find("input[name=tongTienHang]").trigger("change")})}),a("#ClearMaTheGiaTriButton").click(function(){T.find("input[name=maTheGiaTri]").val(""),T.find("input[name=maTheGiaTri]").attr("max-value",""),T.find("input[name=truTuThe]").val(""),T.find("input[name=truTuThe]").attr("readonly","readonly"),T.find("input[name=truTuThe]").trigger("change")}),a("#HangHoaDichVuTabLink").click(function(){d=null==d?DichVuController(t):d}),a("#HoaDonBanLeChiTiet_SoLuong").change(function(){var n=a("input[name=laTangKem]").val(),t=a("input[name=soLuongHangTangConLai]").val(),o=parseFloat(""==a(this).val()?"0":a(this).val());a("input[name=id]").val();return o-=parseFloat(""==a("input[name=soLanDaSuDungCuaHoaDonHienTai").val()?"0":a("input[name=soLanDaSuDungCuaHoaDonHienTai").val()),"False"==n||""==n?(e(i()),!0):!(o>t)||(abp.notify.info(app.localize("KhongTheSuDungQuaSoLuongDuocTang")),!1)}),a("#NhanVienThucHienTable td .m-checkable").on("change",function(){var n=a(this).parents("tr").attr("rowId");a(this).prop("checked")?c.push(n):c=a.grep(c,function(a){return a!=n}),c.length>0?a(".create-nhanvienthuchien-button").attr("disabled",!1):a(".create-nhanvienthuchien-button").attr("disabled",!0)}),a("#NhanVienThucHienTable td .satisfaction-select").on("change",function(){var n=a(this).parents("tr"),i=parseFloat(a(n).find(".sophutthuchien").html())*a(this).find(":selected").attr("percentage")/100;a(n).find("input[name=pTDoanhThuDuocHuong]").val(i)}),a("#NhanVienThucHienTable .m-group-checkable").on("change",function(){c=[],a(this).prop("checked")?(a(".m-checkable").each(function(){a(this).prop("checked",!0);var n=a(this).parent("tr").attr("rowId");c.push(n)}),a(".create-nhanvienthuchien-button").attr("disabled",!1)):(a(".m-checkable").each(function(){a(this).prop("checked",!1)}),a(".create-nhanvienthuchien-button").attr("disabled",!0))}),this.save=function(){if(!1!==e(i())&&T.valid()&&l.valid()&&r.valid()&&!1!==i()){var n="",d="";a(".preview a").each(function(){if(""==n){n+=a(this).attr("href");i=a(this).attr("href").lastIndexOf("/");d+=a(this).attr("href").substring(0,i)+"/thumbs"+a(this).attr("href").substring(i,a(this).attr("href").length)+".80x80.jpg"}else{n+=";"+a(this).attr("href");var i=a(this).attr("href").lastIndexOf("/");d+=";"+a(this).attr("href").substring(0,i)+"/thumbs"+a(this).attr("href").substring(i,a(this).attr("href").length)+".80x80.jpg"}}),a("#fileupload").append('<input type="hidden" id="FileDinhKems" name="FileDinhKems" value="'+n+'">');var h=T.serializeFormToObject(),u=r.serializeFormToObject(),c=a.map(a("#NhanVienThucHienTable tbody tr"),function(n,i){return{iD_CongViec:a(n).attr("rowId"),id:a(n).attr("dataId"),nhanVien:a(n).find("input[name=nhanVien]").val(),ngayThucHien:a(n).find("input[name=ngayThucHien]").val(),danhGia:a(n).find("select[name=danhGia]").val(),dienGiai:a(n).find("input[name=dienGiai]").val()}});(h=a.extend({},h,u)).nhanVienThucHiens=c;var p=l.serializeFormToObject();t.setBusy(!0),o.createOrEdit({thongTinChung:h,thongTinChiTiet:p}).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),t.close(),abp.event.trigger("app.createOrEditHoaDonBanLeModalSaved")}).always(function(){t.setBusy(!1)})}}}}(jQuery),$(function(){function a(){o.ajax.reload()}function n(a){e.getCongDoanToWord(a).done(function(a){app.downloadTempFile(a)})}var i=$("#HoaDonBanLesTable"),e=abp.services.app.hoaDonBanLes;$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var t={create:abp.auth.hasPermission("Pages.HoaDonBanLes.Create"),edit:abp.auth.hasPermission("Pages.HoaDonBanLes.Edit"),delete:abp.auth.hasPermission("Pages.HoaDonBanLes.Delete"),exportsurvey:abp.auth.hasPermission("Pages.HoaDonBanLes.ExportSurvey")},o=(new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_CreateOrEditModal.js",modalClass:"CreateOrEditHoaDonBanLeModal",width:"100%"}),new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/ViewhoaDonBanLeModal",modalClass:"ViewHoaDonBanLeModal"}),i.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:e.getAll,inputFilter:function(){return{filter:$("#HoaDonBanLesTableFilter").val(),maHoaDonFilter:$("#MaHoaDonFilterId").val(),minNgayLapHoaDonFilter:$("#MinNgayLapHoaDonFilterId").val(),maxNgayLapHoaDonFilter:$("#MaxNgayLapHoaDonFilterId").val(),minGioVaoFilter:$("#MinGioVaoFilterId").val(),maxGioVaoFilter:$("#MaxGioVaoFilterId").val(),minGioRaFilter:$("#MinGioRaFilterId").val(),maxGioRaFilter:$("#MaxGioRaFilterId").val(),dienThoai_KhachHangFilter:$("#DienThoai_KhachHangFilterId").val(),minLoaiHoaDonFilter:$("#MinLoaiHoaDonFilterId").val(),maxLoaiHoaDonFilter:$("#MaxLoaiHoaDonFilterId").val(),userLapFilter:$("#UserLapFilterId").val(),minNgayVaoSoFilter:$("#MinNgayVaoSoFilterId").val(),maxNgayVaoSoFilter:$("#MaxNgayVaoSoFilterId").val(),maNhanVienThucHienFilter:$("#MaNhanVienThucHienFilterId").val(),tenNhanVienThucHienFilter:$("#TenNhanVienThucHienFilterId").val(),maNhanVienTuVanFilter:$("#MaNhanVienTuVanFilterId").val(),tenNhanVienTuVanFilter:$("#TenNhanVienTuVanFilterId").val(),dM_ViTriTenViTriFilter:$("#DM_ViTriTenViTriFilterId").val(),dM_DoiTuongTenDoiTuongFilter:$("#DM_DoiTuongTenDoiTuongFilterId").val(),organizationUnitDisplayNameFilter:$("#OrganizationUnitDisplayNameFilterId").val(),dM_DacDiemKhachHangTenDacDiemFilter:$("#DM_DacDiemKhachHangTenDacDiemFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("SurveyExport"),visible:function(){return t.exportsurvey},action:function(a){n(a.record.hoaDonBanLe.id)}}]}},{targets:1,data:"hoaDonBanLe.maHoaDon"},{targets:2,data:"dM_DoiTuongTenDoiTuong"},{targets:3,data:"hoaDonBanLe.ngayLapHoaDon",render:function(a){return a?moment(a).format("L"):""}},{targets:4,data:"hoaDonBanLe.gioVao",render:function(a){return a?moment(a).format("L"):""}},{targets:5,data:"hoaDonBanLe.gioRa",render:function(a){return a?moment(a).format("L"):""}},{targets:6,data:"hoaDonBanLe.tongTienHang"},{targets:7,data:"hoaDonBanLe.tongChietKhau"},{targets:8,data:"hoaDonBanLe.phaiThanhToan"},{targets:9,data:"hoaDonBanLe.dienGiai"},{targets:10,data:"hoaDonBanLe.userLap"},{targets:11,data:"hoaDonBanLe.yeuCau"},{targets:12,data:"dM_ViTriTenViTri"},{targets:13,data:"organizationUnitDisplayName"}]}));abp.event.on("app.createOrEditHoaDonBanLeModalSaved",function(){a()}),$("#GetHoaDonBanLesButton").click(function(n){n.preventDefault(),a()}),$(document).keypress(function(n){13===n.which&&a()})});