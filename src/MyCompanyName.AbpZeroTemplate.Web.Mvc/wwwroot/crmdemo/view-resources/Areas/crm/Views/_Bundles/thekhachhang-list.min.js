var NhanVienThucHien=function(a){function n(){c.ajax.reload()}function e(a){abp.message.confirm("",function(e){e&&l.delete({id:a.id}).done(function(){n(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}function i(a){o.find("input[name=id]").val(a.nhanVienThucHien.id),o.find("input[name=userName]").val(a.userName),o.find("input[name=nhanVien]").val(a.nhanVienThucHien.nhanVien),o.find("input[name=tienChietKhau]").val(a.nhanVienThucHien.tienChietKhau),o.find("input[name=pTDoanhThuDuocHuong]").val(a.nhanVienThucHien.ptDoanhThuDuocHuong),o.find("input[name=dienGiai]").val(a.nhanVienThucHien.dienGiai),o.find("input[name=laNhanVienChinh]").prop("checked",a.nhanVienThucHien.laNhanVienChinh)}var t=a.getModal(),o=t.find("form[name=AddNhanVienThucHienForm]"),h=(a.getModal().find("form[name=HoaDonBanLeInformationsForm]"),t.find("form[name=TheKhachHangInformationsForm]"),$("#NhanVienThucHiensTable")),l=abp.services.app.nhanVienThucHiens,r=t.find("input[name=id]").val();r=""==r||void 0==r?t.find("input[name=tempId]").val():r,$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var u={create:!0,edit:!0,delete:!0},d=new app.ModalManager({viewUrl:abp.appPath+"crm/Common/KTVLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Common/_KTVLookupTableModal.js",modalClass:"KTVLookupTableModal"}),c=h.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:l.getAll,inputFilter:function(){return{maChungTu:r,filter:$("#ChietKhauNhanViensTableFilter").val(),userNameFilter:$("#UserNameFilterId").val(),minTienChietKhauFilter:$("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:$("#MaxTienChietKhauFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("Edit"),visible:function(){return u.edit},action:function(a){_createOrEditModal.open({id:a.record.nhanVienThucHien.id})}},{text:app.localize("Delete"),visible:function(){return u.delete},action:function(a){e(a.record.nhanVienThucHien)}}]}},{targets:1,data:"userName"},{targets:2,data:"nhanVienThucHien.tienChietKhau"},{targets:3,data:"nhanVienThucHien.ptDoanhThuDuocHuong"},{targets:4,data:"nhanVienThucHien.dienGiai"}],select:{style:"single"}});c.on("select",function(a,n,e,t){c.rows({selected:!0}).count()>0&&i(c.rows({selected:!0}).data()[0])}),$(".OpenNhanVienThucHienLookupTableButton").click(function(){var a=$(this).parents("tr");d.open({id:a.find("input[name=nhanVien]").val(),displayName:a.find("input[name=userName]").val()},function(n){a.find("input[name=tenNhanVienThucHien]").val(n.tenNhanVien),a.find("input[name=ngayThucHien]").data("DateTimePicker").date(new Date),a.find("input[name=nhanVien]").val(n.id)})}),$(".ClearNhanVienThucHienButton").click(function(){var a=$(this).parents("tr");a.find("input[name=tenNhanVienThucHien]").val(""),a.find("input[name=nhanVien]").val("")}),$("#OpenNhanVienThucHienLookupTableButton").click(function(){var a=o.serializeFormToObject();d.open({id:a.id,displayName:a.userName},function(a){o.find("input[name=tenNhanVienThucHien]").val(a.tenNhanVien),o.find("input[name=nhanVien]").val(a.id),o.find("input[name=ngayThucHien]").data("DateTimePicker").date(new Date)})}),$("#ClearNhanVienThucHienButton").click(function(){o.find("input[name=tenNhanVienThucHien]").val(""),o.find("input[name=nhanVien]").val("")});var s=function(){if(o.valid()){var a=o.serializeFormToObject();$("#NhanVienThucHienTable td .m-checkable").each(function(){if($(this).prop("checked")){var n=$(this).parents("tr");n.find("input[name=tenNhanVienThucHien]").val(a.tenNhanVienThucHien),n.find("input[name=ngayThucHien]").data("DateTimePicker").date(a.ngayThucHien),n.find("input[name=nhanVien]").val(a.nhanVien),n.find("select[name=danhGia]").val(a.danhGia),n.find("select[name=danhGia]").trigger("change")}})}};return $(".save-nhanvienthuchien-button").click(function(){s(),$(".create-nhanvienthuchien-button").show(),$("form[name=AddNhanVienThucHienForm]").hide()}),$(".create-nhanvienthuchien-button").click(function(){$("form[name=AddNhanVienThucHienForm]").show(),$(this).hide()}),t.find("#CreateNewChietKhauNhanVienButton").click(function(){o[0].reset()}),t.find("#GetChietKhauNhanViensButton").click(function(a){a.preventDefault(),n()}),$(document).keypress(function(a){13===a.which&&n()}),!0},DichVuController=function(a){function n(){p.ajax.reload()}function e(a){abp.message.confirm("",function(e){e&&d.delete({id:a.id}).done(function(){n(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var i=a.getModal().find("#HangHoaDichVuTab"),t=a.getModal().find("input[name=tongTienHang]"),o=a.getModal().find("input[name=id]").val(),h=a.getModal().find("input[name=tempId]").val(),l=!1,r=null;if(""!=o&&void 0!=o||(o=h,l=!0),""!=o){var u=$("#HoaDonBanLeChiTietsTable"),d=abp.services.app.hoaDonBanLeChiTiets;$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var c={create:abp.auth.hasPermission("Pages.HoaDonBanLeChiTiets.Create"),edit:abp.auth.hasPermission("Pages.HoaDonBanLeChiTiets.Edit"),delete:abp.auth.hasPermission("Pages.HoaDonBanLeChiTiets.Delete")},s=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLeChiTiets/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLeChiTiets/_CreateOrEditModal.js",modalClass:"CreateOrEditHoaDonBanLeChiTietModal"}),T=new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLeChiTiets/ViewhoaDonBanLeChiTietModal",modalClass:"ViewHoaDonBanLeChiTietModal"}),p=u.DataTable({paging:!0,serverSide:!0,processing:!0,fnDrawCallback:function(a){var n=a.rawServerResponse.additionalData;t.val(n.tongTienHang)},listAction:{ajaxFunction:d.getAll,inputFilter:function(){return{filter:i.find("#HoaDonBanLeChiTietsTableFilter").val(),hoaDonId:o,hoaDonTempId:h,minSoThuTuFilter:i.find("#MinSoThuTuFilterId").val(),maxSoThuTuFilter:i.find("#MaxSoThuTuFilterId").val(),minThoiGianFilter:i.find("#MinThoiGianFilterId").val(),maxThoiGianFilter:i.find("#MaxThoiGianFilterId").val(),minThoiGianBaoHanhFilter:i.find("#MinThoiGianBaoHanhFilterId").val(),maxThoiGianBaoHanhFilter:i.find("#MaxThoiGianBaoHanhFilterId").val(),minLoaiThoiGianBHFilter:i.find("#MinLoaiThoiGianBHFilterId").val(),maxLoaiThoiGianBHFilter:i.find("#MaxLoaiThoiGianBHFilterId").val(),iD_MaVachFilter:i.find("#ID_MaVachFilterId").val(),chatLieuFilter:i.find("#ChatLieuFilterId").val(),mauSacFilter:i.find("#MauSacFilterId").val(),kichCoFilter:i.find("#KichCoFilterId").val(),minSoLuongFilter:i.find("#MinSoLuongFilterId").val(),maxSoLuongFilter:i.find("#MaxSoLuongFilterId").val(),minDonGiaFilter:i.find("#MinDonGiaFilterId").val(),maxDonGiaFilter:i.find("#MaxDonGiaFilterId").val(),minThanhTienFilter:i.find("#MinThanhTienFilterId").val(),maxThanhTienFilter:i.find("#MaxThanhTienFilterId").val(),minPTChietKhauFilter:i.find("#MinPTChietKhauFilterId").val(),maxPTChietKhauFilter:i.find("#MaxPTChietKhauFilterId").val(),minTienChietKhauFilter:i.find("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:i.find("#MaxTienChietKhauFilterId").val(),minTienThueFilter:i.find("#MinTienThueFilterId").val(),maxTienThueFilter:i.find("#MaxTienThueFilterId").val(),minPTChiPhiFilter:i.find("#MinPTChiPhiFilterId").val(),maxPTChiPhiFilter:i.find("#MaxPTChiPhiFilterId").val(),minTienChiPhiFilter:i.find("#MinTienChiPhiFilterId").val(),maxTienChiPhiFilter:i.find("#MaxTienChiPhiFilterId").val(),minThanhToanFilter:i.find("#MinThanhToanFilterId").val(),maxThanhToanFilter:i.find("#MaxThanhToanFilterId").val(),minGiaVonFilter:i.find("#MinGiaVonFilterId").val(),maxGiaVonFilter:i.find("#MaxGiaVonFilterId").val(),ghiChuFilter:i.find("#GhiChuFilterId").val(),userNhapFilter:i.find("#UserNhapFilterId").val(),minSoLanDaInFilter:i.find("#MinSoLanDaInFilterId").val(),maxSoLanDaInFilter:i.find("#MaxSoLanDaInFilterId").val(),iD_TangKemFilter:i.find("#ID_TangKemFilterId").val(),tangKemFilter:i.find("#TangKemFilterId").val(),minThoiGianThucHienFilter:i.find("#MinThoiGianThucHienFilterId").val(),maxThoiGianThucHienFilter:i.find("#MaxThoiGianThucHienFilterId").val(),minSoLuong_TLFilter:i.find("#MinSoLuong_TLFilterId").val(),maxSoLuong_TLFilter:i.find("#MaxSoLuong_TLFilterId").val(),minSoLuong_YCFilter:i.find("#MinSoLuong_YCFilterId").val(),maxSoLuong_YCFilter:i.find("#MaxSoLuong_YCFilterId").val(),chieuFilter:i.find("#ChieuFilterId").val(),sangFilter:i.find("#SangFilterId").val(),minPTThueFilter:i.find("#MinPTThueFilterId").val(),maxPTThueFilter:i.find("#MaxPTThueFilterId").val(),maNhanVienThucHienFilter:i.find("#MaNhanVienThucHienFilterId").val(),tenNhanVienThucHienFilter:i.find("#TenNhanVienThucHienFilterId").val(),maNhanVienTuVanFilter:i.find("#MaNhanVienTuVanFilterId").val(),tenNhanVienTuVanFilter:i.find("#TenNhanVienTuVanFilterId").val(),maTheLanFilter:i.find("#MaTheLanFilterId").val(),maTheGiaTriFilter:i.find("#MaTheGiaTriFilterId").val(),hoaDonBanLeMaHoaDonFilter:i.find("#HoaDonBanLeMaHoaDonFilterId").val(),dM_HangHoaTenHangHoaFilter:i.find("#DM_HangHoaTenHangHoaFilterId").val(),dM_KhoTenKhoFilter:i.find("#DM_KhoTenKhoFilterId").val(),dM_DonViTinhTenDonViTinhFilter:i.find("#DM_DonViTinhTenDonViTinhFilterId").val(),dM_LoHangSoLoFilter:i.find("#DM_LoHangSoLoFilterId").val(),dM_ThueSuatMaThueSuatFilter:i.find("#DM_ThueSuatMaThueSuatFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("View"),action:function(a){T.open({data:a.record})}},{text:app.localize("Edit"),visible:function(){return c.edit},action:function(n){r=a.getModal().find("input[name=iD_DoiTuong]").val(),s.open({id:n.record.hoaDonBanLeChiTiet.id,khachHangId:r,hoaDonId:o})}},{text:app.localize("Delete"),visible:function(){return c.delete},action:function(a){e(a.record.hoaDonBanLeChiTiet)}}]}},{targets:1,data:"dM_HangHoaTenHangHoa"},{targets:2,data:"dM_DonViTinhTenDonViTinh"},{targets:3,data:"hoaDonBanLeChiTiet.thoiGian",render:function(a){return a?moment(a).format("L"):""}},{targets:4,data:"hoaDonBanLeChiTiet.thoiGianThucHien"},{targets:5,data:"hoaDonBanLeChiTiet.soLuong"},{targets:6,data:"hoaDonBanLeChiTiet.donGia"},{targets:7,data:"hoaDonBanLeChiTiet.thanhTien",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:8,data:"hoaDonBanLeChiTiet.ptChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:9,data:"hoaDonBanLeChiTiet.tienChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:10,data:"hoaDonBanLeChiTiet.thanhToan",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:11,data:"hoaDonBanLeChiTiet.ghiChu"},{targets:12,data:"hoaDonBanLeChiTiet.tangKem",render:function(a){return a?'<i class="la la-check-square m--font-success" title="True"></i>':'<i class="la la-times-circle" title="False"></i>'}},{targets:13,data:"hoaDonBanLeChiTiet.soLuong_TL"},{targets:14,data:"hoaDonBanLeChiTiet.maTheLan"},{targets:15,data:"hoaDonBanLeChiTiet.maTheGiaTri"}]});return i.find("#ShowAdvancedFiltersSpan").click(function(){i.find("#ShowAdvancedFiltersSpan").hide(),i.find("#HideAdvancedFiltersSpan").show(),i.find("#AdvacedAuditFiltersArea").slideDown()}),i.find("#HideAdvancedFiltersSpan").click(function(){i.find("#HideAdvancedFiltersSpan").hide(),i.find("#ShowAdvancedFiltersSpan").show(),i.find("#AdvacedAuditFiltersArea").slideUp()}),i.find("#CreateNewHoaDonBanLeChiTietButton").click(function(){""!=(r=a.getModal().find("input[name=iD_DoiTuong]").val())&&void 0!=r?s.open({id:null,hoaDonId:o,isTempData:l,khachHangId:r}):abp.notify.info(app.localize("YouNeedSelectCustomerFirst"))}),i.find("#ExportToExcelButton").click(function(){d.getHoaDonBanLeChiTietsToExcel({filter:i.find("#HoaDonBanLeChiTietsTableFilter").val(),minSoThuTuFilter:i.find("#MinSoThuTuFilterId").val(),maxSoThuTuFilter:i.find("#MaxSoThuTuFilterId").val(),minThoiGianFilter:i.find("#MinThoiGianFilterId").val(),maxThoiGianFilter:i.find("#MaxThoiGianFilterId").val(),minThoiGianBaoHanhFilter:i.find("#MinThoiGianBaoHanhFilterId").val(),maxThoiGianBaoHanhFilter:i.find("#MaxThoiGianBaoHanhFilterId").val(),minLoaiThoiGianBHFilter:i.find("#MinLoaiThoiGianBHFilterId").val(),maxLoaiThoiGianBHFilter:i.find("#MaxLoaiThoiGianBHFilterId").val(),iD_MaVachFilter:i.find("#ID_MaVachFilterId").val(),chatLieuFilter:i.find("#ChatLieuFilterId").val(),mauSacFilter:i.find("#MauSacFilterId").val(),kichCoFilter:i.find("#KichCoFilterId").val(),minSoLuongFilter:i.find("#MinSoLuongFilterId").val(),maxSoLuongFilter:i.find("#MaxSoLuongFilterId").val(),minDonGiaFilter:i.find("#MinDonGiaFilterId").val(),maxDonGiaFilter:i.find("#MaxDonGiaFilterId").val(),minThanhTienFilter:i.find("#MinThanhTienFilterId").val(),maxThanhTienFilter:i.find("#MaxThanhTienFilterId").val(),minPTChietKhauFilter:i.find("#MinPTChietKhauFilterId").val(),maxPTChietKhauFilter:i.find("#MaxPTChietKhauFilterId").val(),minTienChietKhauFilter:i.find("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:i.find("#MaxTienChietKhauFilterId").val(),minTienThueFilter:i.find("#MinTienThueFilterId").val(),maxTienThueFilter:i.find("#MaxTienThueFilterId").val(),minPTChiPhiFilter:i.find("#MinPTChiPhiFilterId").val(),maxPTChiPhiFilter:i.find("#MaxPTChiPhiFilterId").val(),minTienChiPhiFilter:i.find("#MinTienChiPhiFilterId").val(),maxTienChiPhiFilter:i.find("#MaxTienChiPhiFilterId").val(),minThanhToanFilter:i.find("#MinThanhToanFilterId").val(),maxThanhToanFilter:i.find("#MaxThanhToanFilterId").val(),minGiaVonFilter:i.find("#MinGiaVonFilterId").val(),maxGiaVonFilter:i.find("#MaxGiaVonFilterId").val(),ghiChuFilter:i.find("#GhiChuFilterId").val(),userNhapFilter:i.find("#UserNhapFilterId").val(),minSoLanDaInFilter:i.find("#MinSoLanDaInFilterId").val(),maxSoLanDaInFilter:i.find("#MaxSoLanDaInFilterId").val(),iD_TangKemFilter:i.find("#ID_TangKemFilterId").val(),tangKemFilter:i.find("#TangKemFilterId").val(),minThoiGianThucHienFilter:i.find("#MinThoiGianThucHienFilterId").val(),maxThoiGianThucHienFilter:i.find("#MaxThoiGianThucHienFilterId").val(),minSoLuong_TLFilter:i.find("#MinSoLuong_TLFilterId").val(),maxSoLuong_TLFilter:i.find("#MaxSoLuong_TLFilterId").val(),minSoLuong_YCFilter:i.find("#MinSoLuong_YCFilterId").val(),maxSoLuong_YCFilter:i.find("#MaxSoLuong_YCFilterId").val(),chieuFilter:i.find("#ChieuFilterId").val(),sangFilter:i.find("#SangFilterId").val(),minPTThueFilter:i.find("#MinPTThueFilterId").val(),maxPTThueFilter:i.find("#MaxPTThueFilterId").val(),maNhanVienThucHienFilter:i.find("#MaNhanVienThucHienFilterId").val(),tenNhanVienThucHienFilter:i.find("#TenNhanVienThucHienFilterId").val(),maNhanVienTuVanFilter:i.find("#MaNhanVienTuVanFilterId").val(),tenNhanVienTuVanFilter:i.find("#TenNhanVienTuVanFilterId").val(),maTheLanFilter:i.find("#MaTheLanFilterId").val(),maTheGiaTriFilter:i.find("#MaTheGiaTriFilterId").val(),hoaDonBanLeMaHoaDonFilter:i.find("#HoaDonBanLeMaHoaDonFilterId").val(),dM_HangHoaTenHangHoaFilter:i.find("#DM_HangHoaTenHangHoaFilterId").val(),dM_KhoTenKhoFilter:i.find("#DM_KhoTenKhoFilterId").val(),dM_DonViTinhTenDonViTinhFilter:i.find("#DM_DonViTinhTenDonViTinhFilterId").val(),dM_LoHangSoLoFilter:i.find("#DM_LoHangSoLoFilterId").val(),dM_ThueSuatMaThueSuatFilter:i.find("#DM_ThueSuatMaThueSuatFilterId").val()}).done(function(a){app.downloadTempFile(a)})}),abp.event.on("app.createOrEditHoaDonBanLeChiTietModalSaved",function(){n()}),i.find("#GetHoaDonBanLeChiTietsButton").click(function(a){a.preventDefault(),n()}),i.find(document).keypress(function(a){13===a.which&&n()}),!0}},ChietKhauNhanVien=function(a){function n(){T.ajax.reload()}function e(a){abp.message.confirm("",function(e){e&&u.delete({id:a.id}).done(function(){n(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}function i(a){h.find("input[name=id]").val(a.nhanVienThucHien.id),h.find("input[name=userName]").val(a.userName),h.find("input[name=nhanVien]").val(a.nhanVienThucHien.nhanVien),h.find("input[name=tienChietKhau]").val(a.nhanVienThucHien.tienChietKhau),h.find("input[name=laNhanVienChinh]").prop("checked",a.nhanVienThucHien.laNhanVienChinh)}function t(){h.find("input[name=id]").val(""),h.find("input[name=userName]").val(""),h.find("input[name=nhanVien]").val(""),h.find("input[name=tienChietKhau]").val("")}var o=a.getModal(),h=o.find("form[name=NhanVienTuVanForm]"),l=o.find("form[name=TheKhachHangInformationsForm]"),r=$("#ChietKhauNhanViensTable"),u=abp.services.app.nhanVienThucHiens,d=o.find("input[name=id]").val();d=""==d||void 0==d?o.find("input[name=tempId]").val():d,$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var c={create:!0,edit:!0,delete:!0},s=new app.ModalManager({viewUrl:abp.appPath+"crm/Common/SaleLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Common/_SaleLookupTableModal.js",modalClass:"SaleLookupTableModal"}),T=r.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:u.getAll,inputFilter:function(){return{maChungTu:d,filter:$("#ChietKhauNhanViensTableFilter").val(),userNameFilter:$("#UserNameFilterId").val(),minTienChietKhauFilter:$("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:$("#MaxTienChietKhauFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("Edit"),visible:function(){return c.edit},action:function(a){_createOrEditModal.open({id:a.record.nhanVienThucHien.id})}},{text:app.localize("Delete"),visible:function(){return c.delete},action:function(a){e(a.record.nhanVienThucHien)}}]}},{targets:1,data:"userName"},{targets:2,data:"nhanVienThucHien.tienChietKhau"},{targets:3,data:"nhanVienThucHien.laNhanVienChinh",render:function(a){return a?'<i class="la la-check-square m--font-success" title="True"></i>':'<i class="la la-times-circle" title="False"></i>'}}],select:{style:"single"}});T.on("select",function(a,n,e,t){T.rows({selected:!0}).count()>0&&(i(T.rows({selected:!0}).data()[0]),$(".save-nhanvien-button").show(),$(".cancel-nhanvien-button").show(),$(".add-nhanvien-button").hide())}),$("#OpenNhanVienLookupTableButton").click(function(){var a=h.serializeFormToObject();s.open({id:a.nhanVien,displayName:a.userName},function(a){h.find("input[name=userName]").val(a.tenNhanVien),h.find("input[name=nhanVien]").val(a.id),h.find("input[name=tienChietKhau]").val(a.ptChietKhau)})}),$("#ClearNhanVienButton").click(function(){h.find("input[name=userName]").val(""),h.find("input[name=nhanVien]").val(""),h.find("input[name=tienChietKhau]").val("")});var p=function(){if(h.valid()){var e=l.serializeFormToObject(),i=""==e.tempId?e.id:e.tempId,o=h.serializeFormToObject();o.maChungTu=i,o.loaiChungTu=11,a.setBusy(!0),u.createOrEdit(o).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),n(),t()}).always(function(){a.setBusy(!1)})}};return $(".save-nhanvien-button").click(function(){p()}),$(".reset-nhanvien-button").click(function(){t(),i(T.rows({selected:!0}).data()[0])}),$(".cancel-nhanvien-button").click(function(){t()}),o.find("#CreateNewChietKhauNhanVienButton").click(function(){h[0].reset()}),o.find("#GetChietKhauNhanViensButton").click(function(a){a.preventDefault(),n()}),$(document).keypress(function(a){13===a.which&&n()}),!0},ChiTietHangHoaDichVu=function(a){function n(){u[0].reset(),u.find("input[name=id]").val(""),$("input[name=soLuongTang]").val(0).removeAttr("disabled"),$("input[name=soLuongTang]").val(0).removeAttr("disabled"),$("input[name=thanhToan]").val(0).removeAttr("disabled"),$("input[name=tienChietKhau]").val(0).removeAttr("disabled"),$("input[name=pTChietKhau]").val(0).removeAttr("disabled")}function e(a){if(null!=a)return n(),u.find("input[name=id]").val(a.theKhachHangChiTiet.id),u.find("input[name=dM_HangHoaTenHangHoa]").val(a.dM_HangHoaTenHangHoa),u.find("input[name=iD_HangHoa]").val(a.theKhachHangChiTiet.iD_HangHoa),u.find("input[name=soLuong]").val(a.theKhachHangChiTiet.soLuong),u.find("input[name=donGia]").val(a.theKhachHangChiTiet.donGia),u.find("input[name=pTChietKhau]").val(a.theKhachHangChiTiet.ptChietKhau),u.find("input[name=tienChietKhau]").val(a.theKhachHangChiTiet.tienChietKhau),u.find("input[name=thanhToan]").val(a.theKhachHangChiTiet.thanhToan),u.find("input[name=soLuongTang]").val(a.theKhachHangChiTiet.soLuongTang),u.find("input[name=tienDaSuDung]").val(a.theKhachHangChiTiet.tienDaSuDung),u.find("input[name=soLuongDaSuDung]").val(a.theKhachHangChiTiet.soLuongDaSuDung),u.find("input[name=traLaiHHDV]").val(a.theKhachHangChiTiet.traLaiHHDV),u.find("input[name=ngayTraLai]").val(a.theKhachHangChiTiet.ngayTraLai),u.find("input[name=soLuongTraLai]").val(a.theKhachHangChiTiet.soLuongTraLai),u.find("input[name=ghiChu]").val(a.theKhachHangChiTiet.ghiChu),u.find("input[name=laTangKem]").prop("checked",a.theKhachHangChiTiet.laTangKem),$(".cancel-button").show(),!0}function i(){T.ajax.reload()}function t(a){abp.message.confirm("",function(n){n&&r.delete({id:a.id}).done(function(){getTheKhachHangChiTiets(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var o=a.getModal().find("#HangHoaDichVuTab"),h=""==a.getModal().find("[name=id]").val()?a.getModal().find("[name=tempId]").val():a.getModal().find("[name=id]").val(),l=$("#ChiTietDichVuTable"),r=abp.services.app.theKhachHangChiTiets,u=a.getModal().find("form[name=ChiTietDichVuForm]"),d=a.getModal().find("form[name=TheKhachHangInformationsForm]");$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var c={create:abp.auth.hasPermission("Pages.TheKhachHangs.Create"),edit:abp.auth.hasPermission("Pages.TheKhachHangs.Edit"),delete:abp.auth.hasPermission("Pages.TheKhachHangs.Edit")},s=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangChiTiets/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangChiTiets/_CreateOrEditModal.js",modalClass:"CreateOrEditTheKhachHangChiTietModal"}),T=(new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangChiTiets/ViewtheKhachHangChiTietModal",modalClass:"ViewTheKhachHangChiTietModal"}),l.DataTable({paging:!0,serverSide:!0,processing:!0,responsive:!0,listAction:{ajaxFunction:r.getAll,inputFilter:function(){return{filter:o.find("#TheKhachHangChiTietsTableFilter").val(),iD_TheKhachHang:h,laHangTang:!1,minSoLuongFilter:o.find("#MinSoLuongFilterId").val(),maxSoLuongFilter:o.find("#MaxSoLuongFilterId").val(),minDonGiaFilter:o.find("#MinDonGiaFilterId").val(),maxDonGiaFilter:o.find("#MaxDonGiaFilterId").val(),minPTChietKhauFilter:o.find("#MinPTChietKhauFilterId").val(),maxPTChietKhauFilter:o.find("#MaxPTChietKhauFilterId").val(),minTienChietKhauFilter:o.find("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:o.find("#MaxTienChietKhauFilterId").val(),minThanhToanFilter:o.find("#MinThanhToanFilterId").val(),maxThanhToanFilter:o.find("#MaxThanhToanFilterId").val(),ghiChuFilter:o.find("#GhiChuFilterId").val(),minSoLuongTangFilter:o.find("#MinSoLuongTangFilterId").val(),maxSoLuongTangFilter:o.find("#MaxSoLuongTangFilterId").val(),minNgayTraLaiFilter:o.find("#MinNgayTraLaiFilterId").val(),maxNgayTraLaiFilter:o.find("#MaxNgayTraLaiFilterId").val(),minSoLuongTraLaiFilter:o.find("#MinSoLuongTraLaiFilterId").val(),maxSoLuongTraLaiFilter:o.find("#MaxSoLuongTraLaiFilterId").val(),minTienDaSuDungFilter:o.find("#MinTienDaSuDungFilterId").val(),maxTienDaSuDungFilter:o.find("#MaxTienDaSuDungFilterId").val(),traLaiHHDVFilter:o.find("#TraLaiHHDVFilterId").val(),iD_SanPhamChinhFilter:o.find("#ID_SanPhamChinhFilterId").val(),laTangKemFilter:o.find("#LaTangKemFilterId").val(),minSoLuongDaSuDungFilter:o.find("#MinSoLuongDaSuDungFilterId").val(),maxSoLuongDaSuDungFilter:o.find("#MaxSoLuongDaSuDungFilterId").val(),dM_HangHoaTenHangHoaFilter:o.find("#DM_HangHoaTenHangHoaFilterId").val()}}},select:{style:"single"},columnDefs:[{width:20,targets:0,data:null,orderable:!1,defaultContent:"",rowAction:[{visible:function(){return c.delete},element:$('<button class="btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--remove" title="'+app.localize("Delete")+'"><i class="la la-remove"></i></button>').click(function(){var a=$(this).data();r.delete({id:a.theKhachHangChiTiet.id}),T.ajax.reload(),abp.notify.info(app.localize("DeleteSuccessfully"))})}]},{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("Delete"),visible:function(){return c.delete},action:function(a){t(a.record.theKhachHangChiTiet)}}]}},{targets:1,data:"dM_HangHoaTenHangHoa"},{targets:2,data:"theKhachHangChiTiet.donGia",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:3,data:"theKhachHangChiTiet.soLuong"},{targets:4,data:"theKhachHangChiTiet.soLuongTang"},{targets:5,data:null,render:function(a){return parseInt(null!=a.theKhachHangChiTiet.soLuong?a.theKhachHangChiTiet.soLuong:"0")+parseInt(null!=a.theKhachHangChiTiet.soLuongTang?a.theKhachHangChiTiet.soLuongTang:"0")-parseInt(null!=a.theKhachHangChiTiet.soLuongDaSuDung?a.theKhachHangChiTiet.soLuongDaSuDung:"0")}},{targets:6,data:"theKhachHangChiTiet.tienDaSuDung",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:7,data:"theKhachHangChiTiet.soLuongDaSuDung",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:8,data:"theKhachHangChiTiet.ptChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:9,data:"theKhachHangChiTiet.tienChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:10,data:"theKhachHangChiTiet.ngayTraLai",render:function(a){return a?moment(a).format("L"):""}},{targets:11,data:"theKhachHangChiTiet.soLuongTraLai"},{targets:12,data:"theKhachHangChiTiet.thanhToan",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:13,data:"theKhachHangChiTiet.ghiChu"}]}));return T.on("select",function(a,n,i,t){if(T.rows({selected:!0}).count()>0){var o=T.rows({selected:!0}).data()[0];e(o),o.theKhachHangChiTiet.laTangKem?($("input[name=soLuongTang]").attr("disabled","disabled"),$("input[name=soLuongTang]").attr("disabled","disabled"),$("input[name=thanhToan]").attr("disabled","disabled"),$("input[name=tienChietKhau]").attr("disabled","disabled"),$("input[name=pTChietKhau]").attr("disabled","disabled")):($("input[name=soLuongTang]").removeAttr("disabled"),$("input[name=soLuongTang]").removeAttr("disabled"),$("input[name=thanhToan]").removeAttr("disabled"),$("input[name=tienChietKhau]").removeAttr("disabled"),$("input[name=pTChietKhau]").removeAttr("disabled")),$("#AddNewDichVuButton").hide(),$(".save-dichvu-button").show(),$(".save-dichvu-button").removeAttr("disabled")}return null}),$("input[name=laTangKem]").change(function(){1==$(this).prop("checked")&&($("input[name=soLuongTang]").val(0),$("input[name=thanhToan]").val(0),$("input[name=tienChietKhau]").val(0),$("input[name=ptChietKhau]").val(0),$("input[name=soLuongTang]").val(0).attr("disabled","disabled"),$("input[name=thanhToan]").val(0).attr("disabled","disabled"),$("input[name=tienChietKhau]").val(0).attr("disabled","disabled"),$("input[name=ptChietKhau]").val(0).attr("disabled","disabled"))}),$(".save-dichvu-button").click(function(){var a=u.serializeFormToObject(),e=d.serializeFormToObject();""!=a.iD_HangHoa&&void 0!=a.id&&"0"!=a.soLuong&&""!=a.soLuong&&void 0!=a.soLuong&&($.extend(!0,a,{iD_TheKhachHang:""==e.id?e.tempId:e.id}),r.createOrEdit(a).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));d.find("input[name=voucherId]").val();n();var t=e.voucherValue,o=a.donGia*a.soLuong;t>o&&(t-=o),d.find("input[name=voucherValue]").val(t),i()}))}),$(".traLai-dichvu-button").click(function(){var a=parseFloat(u.find("input[name=soLuongDaSuDung]").val()),n=(parseFloat(u.find("input[name=donGia]").val()),parseFloat(u.find("input[name=soLuong]").val())+parseFloat(u.find("input[name=soLuongTang]").val())-a);u.find("input[name=soLuongTraLai]").val(n),u.find("input[name=traLaiHHDV]").val(!0)}),$(".reset-button").click(function(){e($("#ChiTietDichVuTable").DataTable().rows({selected:!0}).data()[0])}),$(".cancel-button").click(function(){n()}),o.find("#CreateNewTheKhachHangChiTietButton").click(function(){s.open()}),$("#ExportToExcelButton").click(function(){r.getTheKhachHangChiTietsToExcel({filter:$("#TheKhachHangChiTietsTableFilter").val(),minSoLuongFilter:$("#MinSoLuongFilterId").val(),maxSoLuongFilter:$("#MaxSoLuongFilterId").val(),minDonGiaFilter:$("#MinDonGiaFilterId").val(),maxDonGiaFilter:$("#MaxDonGiaFilterId").val(),minPTChietKhauFilter:$("#MinPTChietKhauFilterId").val(),maxPTChietKhauFilter:$("#MaxPTChietKhauFilterId").val(),minTienChietKhauFilter:$("#MinTienChietKhauFilterId").val(),maxTienChietKhauFilter:$("#MaxTienChietKhauFilterId").val(),minThanhToanFilter:$("#MinThanhToanFilterId").val(),maxThanhToanFilter:$("#MaxThanhToanFilterId").val(),ghiChuFilter:$("#GhiChuFilterId").val(),minSoLuongTangFilter:$("#MinSoLuongTangFilterId").val(),maxSoLuongTangFilter:$("#MaxSoLuongTangFilterId").val(),minNgayTraLaiFilter:$("#MinNgayTraLaiFilterId").val(),maxNgayTraLaiFilter:$("#MaxNgayTraLaiFilterId").val(),minSoLuongTraLaiFilter:$("#MinSoLuongTraLaiFilterId").val(),maxSoLuongTraLaiFilter:$("#MaxSoLuongTraLaiFilterId").val(),minTienDaSuDungFilter:$("#MinTienDaSuDungFilterId").val(),maxTienDaSuDungFilter:$("#MaxTienDaSuDungFilterId").val(),traLaiHHDVFilter:$("#TraLaiHHDVFilterId").val(),iD_SanPhamChinhFilter:$("#ID_SanPhamChinhFilterId").val(),laTangKemFilter:$("#LaTangKemFilterId").val(),minSoLuongDaSuDungFilter:$("#MinSoLuongDaSuDungFilterId").val(),maxSoLuongDaSuDungFilter:$("#MaxSoLuongDaSuDungFilterId").val(),theKhachHangMaTheFilter:$("#TheKhachHangMaTheFilterId").val(),dM_HangHoaTenHangHoaFilter:$("#DM_HangHoaTenHangHoaFilterId").val()}).done(function(a){app.downloadTempFile(a)})}),abp.event.on("app.createOrEditTheKhachHangChiTietModalSaved",function(){getTheKhachHangChiTiets()}),o.find("#GetTheKhachHangChiTietsButton").click(function(a){a.preventDefault(),getTheKhachHangChiTiets()}),!0};!function(a){app.modals.CreateOrEditTheLanModal=function(){function n(){var a=parseFloat(u.find("input[name=soLuong]").val()),n=(parseFloat(u.find("input[name=soLuongTang]").val()),parseFloat(u.find("input[name=soLuongDaSuDung]").val()),u.find("input[name=traLaiHHDV]").val(),parseFloat(""==u.find("input[name=soLuongTraLai]").val()?0:u.find("input[name=soLuongTraLai]").val()),parseFloat(u.find("input[name=donGia]").val())*a);return u.find("input[name=thanhTien]").val(n),n}function e(){var a=h.find("input[name=isPercentage]").val(),e=u.find("input[name=laTangKem]").prop("checked"),i=0;if(i=void 0==h.find("input[name=voucherValue]").val()||""==h.find("input[name=voucherValue]").val()?0:parseFloat(h.find("input[name=voucherValue]").val()),1==e)return u.find("input[name=thanhToan]").val(0),0;var t=n(),o=parseFloat(u.find("input[name=tienChietKhau]").val());void 0!=h.find("input[name=voucherValue]").val()&&""!=h.find("input[name=voucherValue]").val()&&("true"==a?o+=t*i/100:i>=t?o=t:i+o>=t?o=t:o+=i);var l=t-o;return u.find("input[name=thanhToan]").val(l),l}function i(a){var n=h.serializeFormToObject();parseFloat(""==n.phaiThanhToan?"0":n.phaiThanhToan)<=parseFloat(""==n.daThanhToan?"0":n.daThanhToan)?abp.notify.info("Thẻ đã thanh toán hết công nợ"):H.open({idThe:a}),t.close()}var t,o=abp.services.app.theKhachHangs,h=(abp.services.app.theKhachHangChiTiets,null),l=null,r=null,u=null,d=null,c=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/DM_NhomTheLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_DM_NhomTheLookupTableModal.js",modalClass:"DM_NhomTheLookupTableModal"}),s=new app.ModalManager({viewUrl:abp.appPath+"crm/Common/DM_DoiTuongLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Common/_DM_DoiTuongLookupTableModal.js",modalClass:"DM_DoiTuongLookupTableModal"}),T=(new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/DM_TienTeLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_DM_TienTeLookupTableModal.js",modalClass:"DM_TienTeLookupTableModal"}),new app.ModalManager({viewUrl:abp.appPath+"crm/Common/SaleLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Common/_SaleLookupTableModal.js",modalClass:"SaleLookupTableModal"})),p=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/OrganizationUnitLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_OrganizationUnitLookupTableModal.js",modalClass:"OrganizationUnitLookupTableModal"}),m=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/DM_DacDiemKhachHangLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_DM_DacDiemKhachHangLookupTableModal.js",modalClass:"DM_DacDiemKhachHangLookupTableModal"}),g=(new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/DM_LienHeLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_DM_LienHeLookupTableModal.js",modalClass:"DM_LienHeLookupTableModal"}),new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/DM_KhuyenMaiLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_DM_KhuyenMaiLookupTableModal.js",modalClass:"DM_KhuyenMaiLookupTableModal"})),f=new app.ModalManager({viewUrl:abp.appPath+"crm/Common/VoucherLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Common/_VoucherLookupTableModal.js",modalClass:"VoucherLookupTableModal"}),v=new app.ModalManager({viewUrl:abp.appPath+"crm/Common/DM_DichVuLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Common/_DM_DichVuLookupTableModal.js",modalClass:"DM_DichVuLookupTableModal",width:"50%"}),D=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/GetTheHuyLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_TheHuyLookupTableModal.js",modalClass:"TheHuyLookupTableModal"}),H=new app.ModalManager({viewUrl:abp.appPath+"crm/PhieuThus/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/PhieuThus/_CreateOrEditModal.js",modalClass:"CreateOrEditPhieuThuModal",width:"50%"});this.init=function(a){var n=(t=a).getModal();n.find(".numeric").number(!0,0),n.find("#TheKhachHangChiTiet_PTChietKhau").number(!0,2),h=t.getModal().find("form[name=TheKhachHangInformationsForm]"),l=t.getModal().find("form[name=NhanVienTuVanForm]"),u=t.getModal().find("form[name=ChiTietDichVuForm]"),h.validate(),l.validate(),n.find(".antikeydown").keydown(function(a){13===a.which&&a.stopPropagation()}),r=null==r?ChiTietHangHoaDichVu(t):r,d=null==d?ChietKhauNhanVien(t):d},this.shown=function(a){a.find("#TheKhachHangChiTietsTable").DataTable().columns.adjust().responsive.recalc()},a("#TheKhachHang_NgayApDung").datetimepicker({format:"L",locale:abp.localization.currentLanguage.name}),a("#TheKhachHang_NgayHetHan").datetimepicker({format:"L",locale:abp.localization.currentLanguage.name}),a("#TheKhachHang_NgayMua").datetimepicker({format:"L",locale:abp.localization.currentLanguage.name}).on("dp.change",function(n){var e=a(this).data("DateTimePicker").date();a("#TheKhachHang_NgayApDung").data("DateTimePicker").date(e),(e=new Date(e)).setFullYear(e.getFullYear()+1),a("#TheKhachHang_NgayHetHan").data("DateTimePicker").date(e)}),a("#OpenDM_NhomTheLookupTableButton").click(function(){var a=h.serializeFormToObject();c.open({id:a.iD_NhomThe,displayName:a.dM_NhomTheTenNhomThe},function(a){h.find("input[name=dM_NhomTheTenNhomThe]").val(a.displayName),h.find("input[name=iD_NhomThe]").val(a.id)})}),a("#ClearDM_NhomTheTenNhomTheButton").click(function(){h.find("input[name=dM_NhomTheTenNhomThe]").val(""),h.find("input[name=iD_NhomThe]").val("")}),a("#OpenDM_DoiTuongLookupTableButton").click(function(){var a=h.serializeFormToObject();s.open({id:a.iD_KhachHang,displayName:a.dM_DoiTuongTenDoiTuong},function(a){h.find("input[name=dM_DoiTuongTenDoiTuong]").val(a.displayName),h.find("input[name=iD_KhachHang]").val(a.id),h.find("input[name=dienThoai]").val(a.phone),h.find("input[name=diaChi]").val(a.address)})}),a("#ClearDM_DoiTuongTenDoiTuongButton").click(function(){h.find("input[name=dM_DoiTuongTenDoiTuong]").val(""),h.find("input[name=iD_KhachHang]").val(""),h.find("input[name=dienThoai]").val(),h.find("input[name=diaChi]").val()}),a("#OpenUserLookupTableButton").click(function(){var a=h.serializeFormToObject();T.open({id:a.iD_NhanVienLap,displayName:a.userName},function(a){h.find("input[name=userName]").val(a.tenNhanVien),h.find("input[name=iD_NhanVienLap]").val(a.id)})}),a("#ClearUserNameButton").click(function(){h.find("input[name=userName]").val(""),h.find("input[name=iD_NhanVienLap]").val("")}),a("#OpenOrganizationUnitLookupTableButton").click(function(){var a=h.serializeFormToObject();p.open({id:a.iD_DonVi,displayName:a.organizationUnitDisplayName},function(a){h.find("input[name=organizationUnitDisplayName]").val(a.displayName),h.find("input[name=iD_DonVi]").val(a.id)})}),a("#ClearOrganizationUnitDisplayNameButton").click(function(){h.find("input[name=organizationUnitDisplayName]").val(""),h.find("input[name=iD_DonVi]").val("")}),a("#OpenDonViThuHuongLookupTableButton").click(function(){var a=h.serializeFormToObject();p.open({id:a.iD_DonViThuHuong,displayName:a.donViThuHuongDisplayName},function(a){h.find("input[name=donViThuHuongDisplayName]").val(a.displayName),h.find("input[name=iD_DonViThuHuong]").val(a.id)})}),a("#ClearDonViThuHuongDisplayNameButton").click(function(){h.find("input[name=donViThuHuongDisplayName]").val(""),h.find("input[name=iD_DonViThuHuong]").val("")}),a("#OpenDonViThucHienLookupTableButton").click(function(){var a=h.serializeFormToObject();p.open({id:a.iD_DonViThucHien,displayName:a.donViThucHienDisplayName},function(a){h.find("input[name=donViThucHienDisplayName]").val(a.displayName),h.find("input[name=iD_DonViThucHien]").val(a.id)})}),a("#ClearDonViThucHienDisplayNameButton").click(function(){h.find("input[name=donViThucHienDisplayName]").val(""),h.find("input[name=iD_DonViThucHien]").val("")}),a("#OpenDM_DacDiemKhachHangLookupTableButton").click(function(){var a=h.serializeFormToObject();m.open({id:a.iD_DacDiemKhachHang,displayName:a.dM_DacDiemKhachHangTenDacDiem},function(a){h.find("input[name=dM_DacDiemKhachHangTenDacDiem]").val(a.displayName),h.find("input[name=iD_DacDiemKhachHang]").val(a.id)})}),a("#ClearDM_DacDiemKhachHangTenDacDiemButton").click(function(){h.find("input[name=dM_DacDiemKhachHangTenDacDiem]").val(""),h.find("input[name=iD_DacDiemKhachHang]").val("")}),a("#OpenTheHuyLookupTableButton").click(function(){var a=h.serializeFormToObject();D.open({id:a.iD_TheCu,displayName:a.theCuMaThe},function(a){h.find("input[name=theHuyMaThe]").val(a.maThe),h.find("input[name=iD_TheCu]").val(a.id)})}),a("#ClearTheHuyButton").click(function(){h.find("input[name=theHuyMaThe]").val(""),h.find("input[name=iD_TheCu]").val("")}),a("#OpenDM_KhuyenMaiLookupTableButton").click(function(){h.serializeFormToObject();g.open({},function(a){h.find("input[name=dM_KhuyenMaiTenKhuyenMai]").val(a.displayName),h.find("#DM_KhuyenMai_ID_KhuyenMai").val(a.id),h.find("input[name=isPercentage]").val(a.isPercentage)})}),a("#ClearDM_KhuyenMaiButton").click(function(){h.find("input[name=dM_KhuyenMaiTenKhuyenMai]").val(""),h.find("#DM_KhuyenMai_ID_KhuyenMai").val(""),h.find("input[name=isPercentage]").val("")}),a("#OpenVoucherLookupTableButton").click(function(){h.serializeFormToObject();f.open({khuyenMaiId:h.find("#DM_KhuyenMai_ID_KhuyenMai").val()},function(a){h.find("input[name=maVoucher]").val(a.voucher.voucherCode),h.find("input[name=voucherId]").val(a.voucher.id),h.find("input[name=voucherValue]").val(a.voucher.voucherValue)})}),a("#ClearVoucherButton").click(function(){h.find("input[name=maVoucher]").val(""),h.find("input[name=voucherId]").val(""),h.find("input[name=voucherValue]").val("")}),a("#OpenDM_HangHoaLookupTableButton").click(function(){v.open({id:null,displayName:null},function(n){a("input[name=dM_HangHoaTenHangHoa]").val(n.displayName),a("input[name=iD_HangHoa]").val(n.id),a("input[name=donGia]").val(n.donGia),a("input[name=soLuong]").val(1),a("input[name=soLuongTang]").val(0),a("input[name=soLuongDaSuDung]").val(0),a("input[name=tienDaSuDung]").val(0),a("input[name=pTChietKhau]").val(0),a("input[name=soLuongTraLai]").val(0),a("input[name=donGia]").trigger("change")})}),a("#ClearDM_HangHoaTenHangHoaButton").click(function(){a("input[name=dM_HangHoaTenHangHoa]").val(""),a("input[name=iD_HangHoa]").val(""),a("input[name=donGia]").val(""),a("input[name=soLuong]").val(0),a("input[name=donGia]").trigger("change")}),a("#TheKhachHangChiTiet_DonGia").change(function(){var a=n();(void 0==h.find("input[name=voucherValue]").val()||""==h.find("input[name=voucherValue]").val()?0:parseFloat(h.find("input[name=voucherValue]").val()))>a&&abp.notify.warn(app.localize("TienChietKhauKhongTheLonHonThanhTien"));var i=a*parseFloat(u.find("input[name=pTChietKhau]").val())/100;u.find("input[name=tienChietKhau]").val(i),e()}),a("#TheKhachHangChiTiet_SoLuong").change(function(){var a=n();void 0==h.find("input[name=voucherValue]").val()||""==h.find("input[name=voucherValue]").val()||parseFloat(h.find("input[name=voucherValue]").val());var i=a*parseFloat(u.find("input[name=pTChietKhau]").val())/100;u.find("input[name=tienChietKhau]").val(i),e()}),a("#TheKhachHangChiTiet_PTChietKhau").change(function(){var a=n(),i=h.find("input[name=isPercentage]").val(),t=0;t=void 0==h.find("input[name=voucherValue]").val()||""==h.find("input[name=voucherValue]").val()?0:parseFloat(h.find("input[name=voucherValue]").val());var o=parseFloat(u.find("input[name=pTChietKhau]").val()),l=0;l="true"==i?a*(100-t)/100*o/100:(a-t)*o/100,u.find("input[name=tienChietKhau]").val(l),e()}),a("#TheKhachHangChiTiet_TienChietKhau").change(function(){var a=n(),i=h.find("input[name=isPercentage]").val(),t=0;(t=void 0==h.find("input[name=voucherValue]").val()||""==h.find("input[name=voucherValue]").val()?0:parseFloat(h.find("input[name=voucherValue]").val()))>a&&abp.notify.warn(app.localize("TienChietKhauKhongTheLonHonThanhTien"));var o=parseFloat(u.find("input[name=tienChietKhau]").val());"true"==i?a=a*(100-t)/100:a-=t;var l=o/a*100;u.find("input[name=pTChietKhau]").val(l),e()}),a("#TheKhachHangChiTiet_SoLuong_TraLai").change(function(){var a=n();(void 0==h.find("input[name=voucherValue]").val()||""==h.find("input[name=voucherValue]").val()?0:parseFloat(h.find("input[name=voucherValue]").val()))>a&&abp.notify.warn(app.localize("TienChietKhauKhongTheLonHonThanhTien"));var i=a*parseFloat(u.find("input[name=pTChietKhau]").val())/100;u.find("input[name=tienChietKhau]").val(i),e()}),a("#TheKhachHangChiTiet_ThanhToan").change(function(){var a=n(),e=parseFloat(u.find("input[name=thanhToan]").val());(void 0==h.find("input[name=voucherValue]").val()||""==h.find("input[name=voucherValue]").val()?0:parseFloat(h.find("input[name=voucherValue]").val()))>a&&abp.notify.warn(app.localize("TienChietKhauKhongTheLonHonThanhTien"));var i=(a-e)/a*100,t=a-e;u.find("input[name=pTChietKhau]").val(i),u.find("input[name=tienChietKhau]").val(t)}),a("#HangHoaDichVuTabLink").click(function(){r=null==r?ChiTietHangHoaDichVu(t):r});var F=function(n){var e=a("#ChiTietDichVuTable").DataTable().rows().count(),i=a("#ChietKhauNhanViensTable").DataTable().rows().data(),l=i.count();if(0!=e)if(0!=l){var r=!1,u=0;if(a.each(i,function(a,n){1==n.nhanVienThucHien.laNhanVienChinh&&(r=!0),u+=n.nhanVienThucHien.tienChietKhau}),100==u)if(r){if(h.valid()){var d=h.serializeFormToObject();t.setBusy(!0),o.createOrEdit(d).done(function(a){abp.notify.info(app.localize("SavedSuccessfully")),n&&n(a),abp.event.trigger("app.createOrEditTheKhachHangModalSaved")}).always(function(){t.setBusy(!1)})}}else abp.notify.info(app.localize("BanCanThemNhanVienChinh"));else abp.notify.info("Tổng phần trăm chiết khấu phải bằng 100")}else abp.notify.info(app.localize("BanCanThemNhanVien"));else abp.notify.info(app.localize("BanCanChonDichVu"))};this.close=function(){t.close()},this.saveWithOtherAction=function(){F(i)},this.save=function(){F()},this.saveAndClose=function(){F(function(){t.close()})}}}(jQuery),$(function(){function a(){var a=n();return null!=a?a.theKhachHang.id:null}function n(){return V.rows({selected:!0}).count()>0?V.rows({selected:!0}).data()[0]:null}function e(){return V.rows({selected:!0}).count()>0&&(V.rows({selected:!0}).data()[0].theKhachHang.status&&!V.rows({selected:!0}).data()[0].theKhachHang.huyThe)}function i(){return V.rows({selected:!0}).count()>0&&V.rows({selected:!0}).data()[0].hetCongNo}function t(){w.ajax.reload()}function o(){}function h(){_.ajax.reload()}function l(){V.ajax.reload()}function r(){I.ajax.reload()}function u(a){abp.message.confirm("",function(n){n&&T.delete({id:a.id}).done(function(){l(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}function d(a){abp.message.confirm("",function(n){n&&D.delete({id:a.id}).done(function(){l(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}function c(a){abp.message.confirm("",function(n){n&&H.delete({id:a.iD_ChungTu}).done(function(){l(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var s=$("#TheKhachHangsTable"),T=abp.services.app.theKhachHangs,p=$("#TheKhachHangChiTietsTable"),m=abp.services.app.theKhachHangChiTiets,g=$("#NhatKySuDungThesTable"),f=abp.services.app.nhatKySuDungThes,v=($("#LichSuChinhSuas"),$("#LichSuThanhToansTable")),D=abp.services.app.phieuThus,H=abp.services.app.suDungThe;Number.prototype.pad=function(a){for(var n=String(this);n.length<(a||2);)n="0"+n;return n},$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var F={create:abp.auth.hasPermission("Pages.TheKhachHangs.Create"),edit:abp.auth.hasPermission("Pages.TheKhachHangs.Edit"),delete:abp.auth.hasPermission("Pages.TheKhachHangs.Delete"),suDungThe:abp.auth.hasPermission("Pages.TheKhachHang.SuDungThe"),editLaterNhatKy:abp.auth.hasPermission("Pages.NhatKySuDungThes.EditLater"),editPhieuThu:abp.auth.hasPermission("Pages.PhieuThus.Edit"),deletePhieuThu:abp.auth.hasPermission("Pages.PhieuThus.Delete"),editLaterPhieuThu:abp.auth.hasPermission("Pages.PhieuThu.EditLater")},C=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/CreateOrEditTheLanModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_CreateOrEditTheLanModal.js",modalClass:"CreateOrEditTheLanModal",width:"100%"}),M=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/CreateOrEditTheGiaTriModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_CreateOrEditTheGiaTriModal.js",modalClass:"CreateOrEditTheGiaTriModal",width:"60%"}),K=new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/ImportTheKhachHangModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/TheKhachHangs/_ImportTheKhachHang.js",modalClass:"ImportTheKhachHangModal",width:"60%"}),b=(new app.ModalManager({viewUrl:abp.appPath+"crm/TheKhachHangs/ViewtheKhachHangModal",modalClass:"ViewTheKhachHangModal"}),new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_CreateOrEditModal.js",modalClass:"CreateOrEditHoaDonBanLeModal",width:"80%"})),L=(new app.ModalManager({viewUrl:abp.appPath+"crm/HoaDonBanLes/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/HoaDonBanLes/_CreateOrEditModal.js",modalClass:"CreateOrEditHoaDonBanLeModal",width:"80%"}),new app.ModalManager({viewUrl:abp.appPath+"crm/PhieuThus/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/PhieuThus/_CreateOrEditModal.js",modalClass:"CreateOrEditPhieuThuModal",width:"50%"})),V=s.DataTable({orderCellsTop:!0,fixedHeader:!0,scrollY:"200px",scrollCollapse:!1,initComplete:function(a,n){$(".lstTheKhachHang").find(".bottom").appendTo(".custom-pagination-position")},paging:!0,serverSide:!0,processing:!0,drawCallback:function(a){V.row(":eq(0)",{page:"current"}).select()},listAction:{ajaxFunction:T.getAll,inputFilter:function(){return{filter:$("#TheKhachHangsTableFilter").val(),isTheLan:$(".loaithe.active").attr("isTheLan"),maTheFilter:$("#MaTheFilterId").val(),organizationUnitDisplayNameFilter:$("#OrganizationUnitDisplayNameFilterId").val(),dM_DacDiemKhachHangTenDacDiemFilter:$("#DM_DacDiemKhachHangTenDacDiemFilterId").val(),dM_DoiTuongMaFilter:$("#DM_DoiTuongMaFilter").val(),dM_DoiTuongPhoneFilter:$("#DM_DoiTuongPhoneFilter").val(),dM_DoiTuongDiaChiFilter:$("#DM_DoiTuongDiaChiFilter").val(),dM_DoiTuongCMTFilter:$("#DM_DoiTuongCMTFilter").val(),dM_DoiTuongTenDoiTuongFilter:$("#DM_DoiTuongTenDoiTuongFilter").val(),maVoucherFilter:$("#MaVoucherFilter").val()}}},columnDefs:[{targets:0,data:"dM_DoiTuongMaDoiTuong"},{targets:1,data:"dM_DoiTuongTenDoiTuong"},{targets:2,data:"dM_DoiTuongPhone"},{targets:3,data:"dM_DoiTuongCMT"},{targets:4,data:"theKhachHang.maThe"},{targets:5,data:"theKhachHang.ngayMua",render:function(a){return a?moment(a).format("L"):""}},{targets:6,data:"theKhachHang.ngayHuy",render:function(a){return a?moment(a).format("L"):""}},{targets:7,data:"seller"},{targets:8,data:"organizationUnitDisplayName"}],createdRow:function(a,n,e){new Date(n.theKhachHang.ngayHetHan)<new Date&&$(a).addClass("expired-service"),0!=n.theKhachHang.status?1!=n.theKhachHang.huyThe||$(a).addClass("canceled-service"):$(a).addClass("stoped-service")},select:{style:"single"}}),I=p.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:m.getAll,inputFilter:function(){return{iD_TheKhachHang:a()}}},columnDefs:[{width:20,targets:0,data:null,orderable:!1,defaultContent:"",rowAction:[{visible:function(){return F.suDungThe},element:$('<button class="btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="'+app.localize("SuDung")+'"><i class="la la-play"></i></button>').click(function(){var a=$(this).data(),i=n(),t=new Date(i.theKhachHang.ngayMua),o=t.getFullYear().toString()+t.getMonth().pad()+t.getDate().pad(),h=new Date,l=h.getFullYear().toString()+h.getMonth().pad()+h.getDate().pad();if(new Date(i.theKhachHang.ngayHetHan)<new Date)abp.notify.info(app.localize("TheDaHetHanSuDung"));else if(a.theKhachHangChiTiet.traLaiHHDV)abp.notify.info(app.localize("DichVuDaTraLai"));else if(i.laDonViThucHien)if(a.theKhachHangChiTiet.soLuongDaSuDung!==a.theKhachHangChiTiet.soLuong+a.theKhachHangChiTiet.soLuongTang)if(new Date(i.theKhachHang.ngayApDung)>new Date)abp.notify.info(app.localize("TheChuaDenThoiGianApDung"));else{if(o!==l&&!(a.theKhachHangChiTiet.soLuongTang>0||a.theKhachHangChiTiet.laSoLuongDuocTang)){var r=a.theKhachHangChiTiet.thanhToan/a.theKhachHangChiTiet.soLuong;if(i.theKhachHang.soDu<r&&i.theKhachHang.phaiThanhToan>i.theKhachHang.daThanhToan)return void abp.notify.success(app.localize("BanCanNapTienDeSuDung"))}e()?b.open({theId:a.theKhachHangChiTiet.iD_TheKhachHang,chiTietTheId:a.theKhachHangChiTiet.id}):abp.notify.info(app.localize("TheCanKichHoatDeSuDung"))}else abp.notify.info(app.localize("HetSoLanSuDung"));else abp.notify.success(app.localize("KhongPhaiDonViThucHien"))})}]},{targets:1,data:"dM_HangHoaTenHangHoa"},{targets:2,data:"theKhachHangChiTiet.donGia",render:function(a){return $.number(a,0)}},{targets:3,data:"theKhachHangChiTiet.laTangKem",render:function(a){return a?'<i class="la la-check-square m--font-success" title="True"></i>':'<i class="la la-times-circle" title="False"></i>'}},{targets:4,data:"theKhachHangChiTiet.soLuong",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:5,data:"theKhachHangChiTiet.soLuongTang",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:6,data:"theKhachHangChiTiet.soLuongDaSuDung",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:7,data:"theKhachHangChiTiet.ptChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:8,data:"theKhachHangChiTiet.tienChietKhau",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:9,data:"theKhachHangChiTiet.thanhToan",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:10,data:"theKhachHangChiTiet.tienDaSuDung",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:11,data:"theKhachHangChiTiet.soLuongTraLai",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:12,data:"theKhachHangChiTiet.ngayTraLai",render:function(a){return a?moment(a).format("L"):""}},{targets:13,data:"theKhachHangChiTiet.ghiChu"}],createdRow:function(a,n,e){n.theKhachHangChiTiet.traLaiHHDV?$(a).addClass("returned-service"):n.theKhachHangChiTiet.soLuongDaSuDung!=n.theKhachHangChiTiet.soLuong+n.theKhachHangChiTiet.soLuongTang||$(a).addClass("limited-service")},select:{style:"single"}}),w=g.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:f.getAll,inputFilter:function(){return{iD_TheKhachHang:a()}}},columnDefs:[{width:120,targets:0,visible:!0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("Edit"),visible:function(a){return F.edit&&(new moment(a.record.nhatKySuDungThe.ngay).add(1,"days").format("YYYYMMDD")>(new moment).format("YYYYMMDD")||new moment(a.record.nhatKySuDungThe.ngay).add(1,"days").format("YYYYMMDD")==(new moment).format("YYYYMMDD")&&(new moment).format("HHmm")<="1100")||F.editLaterNhatKy},action:function(a){b.open({id:a.record.nhatKySuDungThe.iD_ChungTu})}},{text:app.localize("Delete"),visible:function(a){return F.delete&&new moment(a.record.nhatKySuDungThe.ngay).format("YYYYMMDD")==(new moment).format("YYYYMMDD")||F.delete&&F.editLaterNhatKy},action:function(a){c(a.record.nhatKySuDungThe)}}]}},{targets:1,data:"orderNumber"},{targets:2,data:"ngayLapHoaDon",render:function(a){return a?moment(a).format("L"):""}},{targets:3,data:"nhatKySuDungThe.ngay",render:function(a){return a?moment(a).format("L"):""}},{targets:4,data:"dM_HangHoaTenHangHoa"},{targets:5,data:"nhatKySuDungThe.soLuong"},{targets:6,data:"nhatKySuDungThe.soTien",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:7,data:"nhatKySuDungThe.laSoLuongDuocTang",render:function(a){return a?'<i class="la la-check-square m--font-success" title="True"></i>':'<i class="la la-times-circle" title="False"></i>'}},{targets:8,data:"performedOrganizationName"},{targets:9,data:"invoiceCode"}]}),_=v.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:D.getAllByIDTheKhachHang,inputFilter:function(){return{iD_TheKhachHang:a()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("Edit"),visible:function(a){return F.editPhieuThu&&(new moment(a.record.phieuThu.ngayLapPhieu).add(1,"days").format("YYYYMMDD")>(new moment).format("YYYYMMDD")||new moment(a.record.phieuThu.ngayLapPhieu).add(1,"days").format("YYYYMMDD")==(new moment).format("YYYYMMDD")&&(new moment).format("HHmm")<="1100")||F.editLaterPhieuThu},action:function(a){L.open({id:a.record.phieuThu.id})}},{text:app.localize("Delete"),visible:function(){return F.deletePhieuThu},action:function(a){d(a.record.phieuThu)}}]}},{targets:1,data:"phieuThu.maPhieuThu"},{targets:2,data:"phieuThu.ngayLapPhieu",render:function(a){return a?moment(a).format("L"):""}},{targets:3,data:"phieuThu.tongTienThu",render:function(a){return'<span class="numeric-cell">'+$.number(a,0)+"</span>"}},{targets:4,data:"phieuThu.noiDungThu"},{targets:5,data:"userName"},{targets:6,data:"organizationUnitDisplayName"}]});V.on("select",function(a,n,e,i){var l=V.row({selected:!0}).data();$("#daThanhToan").html($.number(l.theKhachHang.daThanhToan+(void 0==l.theKhachHang.tienNhanTuTheCu?0:l.theKhachHang.tienNhanTuTheCu),0)),$("#phaiThanhToan").html($.number(l.theKhachHang.phaiThanhToan,0)),$("#conLai").html($.number(l.theKhachHang.phaiThanhToan-(void 0==l.theKhachHang.daThanhToan?0:l.theKhachHang.daThanhToan)-(void 0==l.theKhachHang.tienNhanTuTheCu?0:l.theKhachHang.tienNhanTuTheCu),0)),1==l.theKhachHang.theGiaTri_SoLan_GiamGia?($("input[name=id]").val(l.theKhachHang.id),$("#dM_NhomTheTenNhomThe").html(l.dM_NhomTheTenNhomThe),$("#maThe").html(l.theKhachHang.maThe),$("#menhGiaThe").html($.number(l.theKhachHang.menhGiaThe,0)),$("#tienTangThem").html($.number(l.theKhachHang.tienTangThem,0)),$("#pTChietKhau").html($.number(l.theKhachHang.ptChietKhau,0)),$("#tienChietKhau").html($.number(l.theKhachHang.tienChietKhau,0)),$("#userName").html(l.userName),$("#ngayMua").html(moment(l.theKhachHang.ngayMua).format("L")),$("#ngayApDung").html(moment(l.theKhachHang.ngayApDung).format("L")),$("#ngayHetHan").html(moment(l.theKhachHang.ngayHetHan).format("L")),$("#ghiChu").html(l.theKhachHang.ghiChu),$("#theGiaTriChiTiet").show(),$("#theLanChiTiet").hide(),$(".use-button").show()):($("#theGiaTriChiTiet").hide(),$("#theLanChiTiet").show(),r(),$(".use-button").hide()),t(),o(),h()}),$(".use-button").click(function(){var e=n(),i=new Date(e.theKhachHang.ngayMua),t=i.getFullYear().toString()+i.getMonth().pad()+i.getDate().pad(),o=new Date,h=o.getFullYear().toString()+o.getMonth().pad()+o.getDate().pad();if(new Date(e.theKhachHang.ngayHetHan)<new Date)abp.notify.success(app.localize("TheDaHetHanSuDung"));else if(new Date(e.theKhachHang.ngayApDung)>new Date)abp.notify.success(app.localize("TheChuaDenThoiGianApDung"));else if(!e.theKhachHang.huyThe&&e.theKhachHang.status)if(t!=h&&0==e.theKhachHang.soDu&&e.theKhachHang.phaiThanhToan>e.theKhachHang.daThanhToan)abp.notify.success(app.localize("BanCanNapTienDeSuDung"));else{var l=a();b.open({theId:l})}else abp.notify.success(app.localize("TheCanKichHoatDeSuDung"))}),$(".edit-button").click(function(){var e=n(),i=a();1==e.theKhachHang.theGiaTri_SoLan_GiamGia?M.open({id:i}):C.open({id:i})}),$(".remove-button").click(function(){u(n().theKhachHang)}),$(".pay-button").click(function(){V.row($(this).parent("tr")).data();var a=n().theKhachHang.id;i()?abp.notify.success(app.localize("TheDaThanhToanHetCongNo")):L.open({idThe:a})}),$(".loaithe").click(function(){$(".loaithe.active").removeClass("active"),$(this).addClass("active"),l()}),$("#CreateNewTheLanButton").click(function(){C.open()}),$("#CreateNewTheGiaTriButton").click(function(){M.open()}),$("#ImportTheDataButton").click(function(){K.open()}),abp.event.on("app.createOrEditTheKhachHangModalSaved",function(){l()}),abp.event.on("app.createOrEditHoaDonBanLeModalSaved",function(){l()}),abp.event.on("app.createOrEditPhieuThuModalSaved",function(){l()}),$("#GetTheKhachHangsButton").click(function(a){a.preventDefault(),l()}),$(".datatable-filter").keyup(function(a){13==a.keyCode&&(a.preventDefault(),l())}),$("#TheKhachHangFiltersArea input").keypress(function(a){13===a.which&&l()})});var QuickNav={init:function(){if($(".quick-nav").length>0){var a=$(".quick-nav");a.each(function(){var a=$(this);a.find(".quick-nav-trigger").on("click",function(n){n.preventDefault(),a.toggleClass("nav-is-visible")})}),$(document).on("click",function(n){!$(n.target).is(".quick-nav-trigger")&&!$(n.target).is(".quick-nav-trigger span")&&a.removeClass("nav-is-visible")})}}};QuickNav.init();