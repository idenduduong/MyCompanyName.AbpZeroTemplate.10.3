var OrganizationTree=function(e){return function(){function t(){var t=!1;e("#OrganizationTreeFilter").keyup(function(){t&&clearTimeout(t),t=setTimeout(function(){var t=e("#OrganizationTreeFilter").val();i.jstree(!0).search(t)},250)})}function a(e){i.jstree("select_node",e,!0);var t=i.jstree("get_parent",e);t&&a(t)}var i;return{init:function(n){(i=n).jstree({types:{default:{icon:"fa fa-folder m--font-warning"},file:{icon:"fa fa-file  m--font-warning"}},checkbox:{keep_selected_style:!1,three_state:!1,cascade:""},search:{show_only_matches:!0},plugins:["types","search"]}),i.on("changed.jstree",function(t,n){if(n.node){var o;n.node.state.selected?(a(i.jstree("get_parent",n.node)),o=e.makeArray(i.jstree("get_children_dom",n.node)),i.jstree("select_node",o)):(o=e.makeArray(i.jstree("get_children_dom",n.node)),i.jstree("deselect_node",o))}}),t()},getSelectedOrganizations:function(){for(var e=[],t=i.jstree("get_selected",!0),a=0;a<t.length;a++)e.push(t[a].id);return e}}}}(jQuery);!function(e){app.modals.CreateOrEditDM_KhoModal=function(){var t,a=abp.services.app.dM_Khos,i=null;this.init=function(a){var n=(t=a).getModal();n.find(".numeric").number(!0,0),n.find(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"}),n.find(".date-picker").each(function(){"01/01/0001"==e(this).val()&&e(this).data("DateTimePicker").date(new Date)}),_organizationTree=new OrganizationTree,_organizationTree.init(t.getModal().find(".organization-tree")),(i=t.getModal().find("form[name=DM_KhoInformationsForm]")).validate()},this.save=function(){if(i.valid()){var e=i.serializeFormToObject();t.setBusy(!0),a.createOrEdit({dM_Kho:e,organizationUnits:_organizationTree.getSelectedOrganizations()}).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),t.close(),abp.event.trigger("app.createOrEditDM_KhoModalSaved")}).always(function(){t.setBusy(!1)})}}}}(jQuery),$(function(){function e(){l.ajax.reload()}function t(t){abp.message.confirm("",function(a){a&&i.delete({id:t.id}).done(function(){e(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var a=$("#DM_KhosTable"),i=abp.services.app.dM_Khos;$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var n={create:abp.auth.hasPermission("Pages.Categories.DM_Khos.Create"),edit:abp.auth.hasPermission("Pages.Categories.DM_Khos.Edit"),delete:abp.auth.hasPermission("Pages.Categories.DM_Khos.Delete")},o=new app.ModalManager({viewUrl:abp.appPath+"crm/DM_Khos/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/DM_Khos/_CreateOrEditModal.js",modalClass:"CreateOrEditDM_KhoModal"}),r=new app.ModalManager({viewUrl:abp.appPath+"crm/DM_Khos/ViewdM_KhoModal",modalClass:"ViewDM_KhoModal"}),l=a.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:i.getAll,inputFilter:function(){return{filter:$("#DM_KhosTableFilter").val(),maKhoFilter:$("#MaKhoFilterId").val(),tenKhoFilter:$("#TenKhoFilterId").val(),diaDiemFilter:$("#DiaDiemFilterId").val(),ghiChuFilter:$("#GhiChuFilterId").val(),iD_DonVisFilter:$("#ID_DonVisFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("View"),action:function(e){r.open({data:e.record})}},{text:app.localize("Edit"),visible:function(){return n.edit},action:function(e){o.open({id:e.record.dM_Kho.id})}},{text:app.localize("Delete"),visible:function(){return n.delete},action:function(e){t(e.record.dM_Kho)}}]}},{targets:1,data:"dM_Kho.maKho"},{targets:2,data:"dM_Kho.tenKho"},{targets:3,data:"dM_Kho.diaDiem"},{targets:4,data:"dM_Kho.ghiChu"},{targets:5,data:"dM_Kho.tenDonVis"}]});$("#ShowAdvancedFiltersSpan").click(function(){$("#ShowAdvancedFiltersSpan").hide(),$("#HideAdvancedFiltersSpan").show(),$("#AdvacedAuditFiltersArea").slideDown()}),$("#HideAdvancedFiltersSpan").click(function(){$("#HideAdvancedFiltersSpan").hide(),$("#ShowAdvancedFiltersSpan").show(),$("#AdvacedAuditFiltersArea").slideUp()}),$("#CreateNewDM_KhoButton").click(function(){o.open()}),$("#ExportToExcelButton").click(function(){i.getDM_KhosToExcel({filter:$("#DM_KhosTableFilter").val(),maKhoFilter:$("#MaKhoFilterId").val(),tenKhoFilter:$("#TenKhoFilterId").val(),diaDiemFilter:$("#DiaDiemFilterId").val(),ghiChuFilter:$("#GhiChuFilterId").val(),iD_DonVisFilter:$("#ID_DonVisFilterId").val()}).done(function(e){app.downloadTempFile(e)})}),abp.event.on("app.createOrEditDM_KhoModalSaved",function(){e()}),$("#GetDM_KhosButton").click(function(t){t.preventDefault(),e()}),$(document).keypress(function(t){13===t.which&&e()})});