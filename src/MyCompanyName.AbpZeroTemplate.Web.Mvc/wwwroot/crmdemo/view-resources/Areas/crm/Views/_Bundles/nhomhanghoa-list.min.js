var OrganizationTree=function(e){return function(){function a(){var a=!1;e("#OrganizationTreeFilter").keyup(function(){a&&clearTimeout(a),a=setTimeout(function(){var a=e("#OrganizationTreeFilter").val();n.jstree(!0).search(a)},250)})}function i(e){n.jstree("select_node",e,!0);var a=n.jstree("get_parent",e);a&&i(a)}var n;return{init:function(t){(n=t).jstree({types:{default:{icon:"fa fa-folder m--font-warning"},file:{icon:"fa fa-file  m--font-warning"}},checkbox:{keep_selected_style:!1,three_state:!1,cascade:""},search:{show_only_matches:!0},plugins:["types","search"]}),n.on("changed.jstree",function(a,t){if(t.node){var o;t.node.state.selected?(i(n.jstree("get_parent",t.node)),o=e.makeArray(n.jstree("get_children_dom",t.node)),n.jstree("select_node",o)):(o=e.makeArray(n.jstree("get_children_dom",t.node)),n.jstree("deselect_node",o))}}),a()},getSelectedOrganizations:function(){for(var e=[],a=n.jstree("get_selected",!0),i=0;i<a.length;i++)e.push(a[i].id);return e}}}}(jQuery);!function(e){app.modals.CreateOrEditDM_NhomHangHoaModal=function(){var a,i=abp.services.app.dM_NhomHangHoas,n=null,t=new app.ModalManager({viewUrl:abp.appPath+"crm/DM_NhomHangHoas/DM_KhoLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/DM_NhomHangHoas/_DM_KhoLookupTableModal.js",modalClass:"DM_KhoLookupTableModal"}),o=new app.ModalManager({viewUrl:abp.appPath+"crm/DM_NhomHangHoas/ParentLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/DM_NhomHangHoas/_ParentLookupTableModal.js",modalClass:"ParentLookupTableModal"});this.init=function(i){var t=(a=i).getModal();t.find(".numeric").number(!0,0),t.find(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"}),t.find(".date-picker").each(function(){"01/01/0001"==e(this).val()&&e(this).data("DateTimePicker").date(new Date)}),_organizationTree=new OrganizationTree,_organizationTree.init(a.getModal().find(".organization-tree")),(n=a.getModal().find("form[name=DM_NhomHangHoaInformationsForm]")).validate()},e("#OpenDM_KhoLookupTableButton").click(function(){var e=n.serializeFormToObject();t.open({id:e.iD_Kho,displayName:e.dM_KhoTenKho},function(e){n.find("input[name=dM_KhoTenKho]").val(e.displayName),n.find("input[name=iD_Kho]").val(e.id)})}),e("#OpenParentLookupTableButton").click(function(){var e=n.serializeFormToObject();o.open({id:e.iD_Parent,displayName:e.parentName},function(e){n.find("input[name=parentName]").val(e.displayName),n.find("input[name=iD_Parent]").val(e.id)})}),e("#ClearDM_KhoTenKhoButton").click(function(){n.find("input[name=dM_KhoTenKho]").val(""),n.find("input[name=iD_Kho]").val("")}),e("#ClearParentButton").click(function(){n.find("input[name=parentName]").val(""),n.find("input[name=iD_Parent]").val("")}),this.save=function(){if(n.valid()){var e=n.serializeFormToObject();a.setBusy(!0),i.createOrEdit({dM_NhomHangHoa:e,organizationUnits:_organizationTree.getSelectedOrganizations()}).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),a.close(),abp.event.trigger("app.createOrEditDM_NhomHangHoaModalSaved")}).always(function(){a.setBusy(!1)})}}}}(jQuery),$(function(){function e(){r.ajax.reload()}function a(a){abp.message.confirm("",function(i){i&&n.delete({id:a.id}).done(function(){e(!0),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var i=$("#DM_NhomHangHoasTable"),n=abp.services.app.dM_NhomHangHoas;$(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var t={create:abp.auth.hasPermission("Pages.Categories.DM_NhomHangHoas.Create"),edit:abp.auth.hasPermission("Pages.Categories.DM_NhomHangHoas.Edit"),delete:abp.auth.hasPermission("Pages.Categories.DM_NhomHangHoas.Delete")},o=new app.ModalManager({viewUrl:abp.appPath+"crm/DM_NhomHangHoas/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/crm/Views/DM_NhomHangHoas/_CreateOrEditModal.js",modalClass:"CreateOrEditDM_NhomHangHoaModal"}),r=(new app.ModalManager({viewUrl:abp.appPath+"crm/DM_NhomHangHoas/ViewdM_NhomHangHoaModal",modalClass:"ViewDM_NhomHangHoaModal"}),i.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:n.getAll,inputFilter:function(){return{filter:$("#DM_NhomHangHoasTableFilter").val(),maNhomFilter:$("#MaNhomFilterId").val(),tenNhomFilter:$("#TenNhomFilterId").val(),ghiChuFilter:$("#GhiChuFilterId").val(),iD_ParentFilter:$("#ID_ParentFilterId").val(),laNhomHangHoaFilter:$("#LaNhomHangHoaFilterId").val(),hienThi_ChinhFilter:$("#HienThi_ChinhFilterId").val(),hienThi_PhuFilter:$("#HienThi_PhuFilterId").val(),mayInFilter:$("#MayInFilterId").val(),hienThi_BanTheFilter:$("#HienThi_BanTheFilterId").val(),minMauHienThiFilter:$("#MinMauHienThiFilterId").val(),maxMauHienThiFilter:$("#MaxMauHienThiFilterId").val(),iD_DonVisFilter:$("#ID_DonVisFilterId").val(),dM_KhoTenKhoFilter:$("#DM_KhoTenKhoFilterId").val()}}},columnDefs:[{width:120,targets:0,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{cssClass:"btn btn-brand dropdown-toggle",text:'<i class="fa fa-cog"></i> '+app.localize("Actions")+' <span class="caret"></span>',items:[{text:app.localize("Edit"),visible:function(){return t.edit},action:function(e){o.open({id:e.record.dM_NhomHangHoa.id})}},{text:app.localize("Delete"),visible:function(){return t.delete},action:function(e){a(e.record.dM_NhomHangHoa)}}]}},{targets:1,data:"dM_NhomHangHoa.maNhom"},{targets:2,data:"dM_NhomHangHoa.tenNhom"},{targets:3,data:"dM_NhomHangHoa.ghiChu"},{targets:4,data:"dM_NhomHangHoa.laNhomHangHoa",render:function(e){return e?'<i class="la la-check-square m--font-success" title="True"></i>':'<i class="la la-times-circle" title="False"></i>'}},{targets:5,data:"dM_NhomHangHoa.hienThi_BanThe",render:function(e){return e?'<i class="la la-check-square m--font-success" title="True"></i>':'<i class="la la-times-circle" title="False"></i>'}},{targets:6,data:"dM_KhoTenKho"}]}));$("#ShowAdvancedFiltersSpan").click(function(){$("#ShowAdvancedFiltersSpan").hide(),$("#HideAdvancedFiltersSpan").show(),$("#AdvacedAuditFiltersArea").slideDown()}),$("#HideAdvancedFiltersSpan").click(function(){$("#HideAdvancedFiltersSpan").hide(),$("#ShowAdvancedFiltersSpan").show(),$("#AdvacedAuditFiltersArea").slideUp()}),$("#CreateNewDM_NhomHangHoaButton").click(function(){o.open()}),$("#ExportToExcelButton").click(function(){n.getDM_NhomHangHoasToExcel({filter:$("#DM_NhomHangHoasTableFilter").val(),maNhomFilter:$("#MaNhomFilterId").val(),tenNhomFilter:$("#TenNhomFilterId").val(),ghiChuFilter:$("#GhiChuFilterId").val(),iD_ParentFilter:$("#ID_ParentFilterId").val(),laNhomHangHoaFilter:$("#LaNhomHangHoaFilterId").val(),hienThi_ChinhFilter:$("#HienThi_ChinhFilterId").val(),hienThi_PhuFilter:$("#HienThi_PhuFilterId").val(),mayInFilter:$("#MayInFilterId").val(),hienThi_BanTheFilter:$("#HienThi_BanTheFilterId").val(),minMauHienThiFilter:$("#MinMauHienThiFilterId").val(),maxMauHienThiFilter:$("#MaxMauHienThiFilterId").val(),iD_DonVisFilter:$("#ID_DonVisFilterId").val(),dM_KhoTenKhoFilter:$("#DM_KhoTenKhoFilterId").val()}).done(function(e){app.downloadTempFile(e)})}),abp.event.on("app.createOrEditDM_NhomHangHoaModalSaved",function(){e()}),$("#GetDM_NhomHangHoasButton").click(function(a){a.preventDefault(),e()}),$(document).keypress(function(a){13===a.which&&e()})});